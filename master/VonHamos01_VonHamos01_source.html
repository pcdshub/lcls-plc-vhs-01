

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DUTs &mdash; pcdshub/lcls-plc-vhs-01  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/tree.css?v=837a00b9" />
      <link rel="stylesheet" type="text/css" href="_static/width.css?v=ab210c7a" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/docs-versions-menu.js?v=3d6a1aea"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Data Types" href="VonHamos01_VonHamos01_epics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            pcdshub/lcls-plc-vhs-01
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">VonHamos01</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="VonHamos01_pragmas.html">Pragmas</a></li>
<li class="toctree-l1"><a class="reference internal" href="VonHamos01_nc.html">NC Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="VonHamos01_ethercat.html">EtherCAT Terminals</a></li>
<li class="toctree-l1"><a class="reference internal" href="VonHamos01_boxes.html">Boxes</a></li>
<li class="toctree-l1"><a class="reference internal" href="VonHamos01_links.html">Links</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">VonHamos01</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="VonHamos01_VonHamos01_summary.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="VonHamos01_VonHamos01_summary.html#pragmas">Pragmas</a></li>
<li class="toctree-l1"><a class="reference internal" href="VonHamos01_VonHamos01_summary.html#libraries">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="VonHamos01_VonHamos01_summary.html#symbols">Symbols</a></li>
<li class="toctree-l1"><a class="reference internal" href="VonHamos01_VonHamos01_epics.html">Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="VonHamos01_VonHamos01_epics.html#database-records">Database Records</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">DUTs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dut-axisstatus-v0-01">DUT_AxisStatus_v0_01</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#gvls">GVLs</a></li>
<li class="toctree-l1"><a class="reference internal" href="#pous">POUs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#fb-drivevirtual">FB_DriveVirtual</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-homedirect">FB_HomeDirect</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-homefinish">FB_HomeFinish</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-homeprepare">FB_HomePrepare</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-homereadncvelocities">FB_HomeReadNcVelocities</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-homereadsoftlimenable">FB_HomeReadSoftLimEnable</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-hometoswitch">FB_HomeToSwitch</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-homevirtual">FB_HomeVirtual</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-homewritencvelocities">FB_HomeWriteNcVelocities</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-homewritesoftlimenable">FB_HomeWriteSoftLimEnable</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-ncaxis">FB_NcAxis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-readfloatparameter">FB_ReadFloatParameter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-readparameterinnc-v1-00">FB_ReadParameterInNc_v1_00</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-writefloatparameter">FB_WriteFloatParameter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-writeparameterinnc-v1-00">FB_WriteParameterInNc_v1_00</a></li>
<li class="toctree-l2"><a class="reference internal" href="#main">Main</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pcdshub/lcls-plc-vhs-01</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">DUTs</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/VonHamos01_VonHamos01_source.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="duts">
<h1>DUTs<a class="headerlink" href="#duts" title="Link to this heading"></a></h1>
<section id="dut-axisstatus-v0-01">
<h2>DUT_AxisStatus_v0_01<a class="headerlink" href="#dut-axisstatus-v0-01" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">DUT_AxisStatus_v0_01</span> <span class="p">:</span>
<span class="n">STRUCT</span>
    <span class="n">bEnable</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bReset</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nCommand</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">nCmdData</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">fVelocity</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosition</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fAcceleration</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fDeceleration</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">bJogFwd</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bJogBwd</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bLimitFwd</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bLimitBwd</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">fOverride</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="n">bHomeSensor</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bEnabled</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
    <span class="n">fActVelocity</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fActPosition</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fActDiff</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">bHomed</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#dut-axisstatus-v0-01">DUT_AxisStatus_v0_01</a></p></li>
</ul>
</dd>
</dl>
</section>
</section>
<section id="gvls">
<h1>GVLs<a class="headerlink" href="#gvls" title="Link to this heading"></a></h1>
</section>
<section id="pous">
<h1>POUs<a class="headerlink" href="#pous" title="Link to this heading"></a></h1>
<section id="fb-drivevirtual">
<h2>FB_DriveVirtual<a class="headerlink" href="#fb-drivevirtual" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">///</span><span class="c1">#########################################################</span>
<span class="o">///</span><span class="n">Function</span> <span class="n">block</span> <span class="n">to</span> <span class="n">run</span> <span class="n">a</span> <span class="n">virtual</span> <span class="n">drive</span> <span class="k">with</span> <span class="n">Nc</span>
<span class="o">///</span> <span class="n">Library</span><span class="p">:</span>
<span class="o">///</span> <span class="n">Tc2_MC2</span><span class="o">.</span><span class="n">lib</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">Global</span> <span class="n">Variables</span><span class="p">:</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">Data</span> <span class="n">types</span><span class="p">:</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">External</span> <span class="n">functions</span><span class="p">:</span>
<span class="o">///</span>
<span class="o">///</span><span class="c1">###########################################################</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">FB_DriveVirtual</span>
<span class="n">VAR</span>
    <span class="n">sVersion</span><span class="p">:</span> <span class="n">STRING</span><span class="o">:=</span><span class="s1">&#39;1.0.3&#39;</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>
    <span class="n">En</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bEnable</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bReset</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="o">/////</span>   <span class="n">nCommandLocal</span><span class="o">...</span>
    <span class="o">/////</span>   <span class="mi">0</span> <span class="o">=</span> <span class="n">Jog</span>
    <span class="o">/////</span>   <span class="mi">1</span> <span class="o">=</span> <span class="n">MoveVelocity</span>
    <span class="o">/////</span>   <span class="mi">2</span> <span class="o">=</span> <span class="n">MoveRelative</span>
    <span class="o">/////</span>   <span class="mi">3</span> <span class="o">=</span> <span class="n">MoveAbsolut</span>
    <span class="o">/////</span>   <span class="mi">4</span> <span class="o">=</span> <span class="n">MoveModulo</span>
    <span class="o">/////</span>   <span class="mi">10</span> <span class="o">=</span> <span class="n">Homing</span>
    <span class="o">/////</span>   <span class="mi">20</span> <span class="o">=</span> <span class="n">SuperInp</span> <span class="o">&gt;&gt;&gt;</span><span class="n">ToBe</span>
    <span class="o">/////</span>   <span class="mi">30</span> <span class="o">=</span> <span class="n">Gear</span>
    <span class="n">nCommand</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">nCmdData</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">fVelocity</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosition</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fAcceleration</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fDeceleration</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">bJogFwd</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bJogBwd</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bLimitFwd</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bLimitBwd</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">fOverride</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="n">bHomeSensor</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">fHomePosition</span><span class="p">:</span><span class="n">LREAL</span><span class="p">;</span>
    <span class="n">nHomeRevOffset</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">MasterAxis</span><span class="p">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">EnO</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bEnabled</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bDone</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bHomed</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
    <span class="n">nMotionAxisID</span><span class="p">:</span><span class="n">UDINT</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>  <span class="o">//</span><span class="n">Axis</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">Motion</span> <span class="p">(</span><span class="n">NC</span><span class="p">)</span>
    <span class="n">Status</span><span class="p">:</span> <span class="n">ST_AxisStatus</span><span class="p">;</span>
    <span class="n">fActVelocity</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fActPosition</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fActDiff</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">sErrorMessage</span><span class="p">:</span><span class="n">STRING</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">Axis</span><span class="p">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">nCommandLocal</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">nCmdDataLocal</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">bFirstScan</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbReset</span><span class="p">:</span> <span class="n">MC_Reset</span><span class="p">;</span>
    <span class="n">fbPower</span><span class="p">:</span> <span class="n">MC_Power</span><span class="p">;</span>
    <span class="n">fbHalt</span><span class="p">:</span> <span class="n">MC_Halt</span><span class="p">;</span>
    <span class="n">fbJog</span><span class="p">:</span> <span class="n">MC_Jog</span><span class="p">;</span>
    <span class="n">fbMoveVelocity</span><span class="p">:</span> <span class="n">MC_MoveVelocity</span><span class="p">;</span>
    <span class="n">fbMoveRelative</span><span class="p">:</span> <span class="n">MC_MoveRelative</span><span class="p">;</span>
    <span class="n">fbMoveAbsolute</span><span class="p">:</span> <span class="n">MC_MoveAbsolute</span><span class="p">;</span>
    <span class="n">fbMoveModulo</span><span class="p">:</span> <span class="n">MC_MoveModulo</span><span class="p">;</span>
    <span class="n">fbHomeVirtual</span><span class="p">:</span><span class="n">FB_HomeVirtual</span><span class="p">;</span>
    <span class="n">fbGearInDyn</span><span class="p">:</span> <span class="n">MC_GearInDyn</span><span class="p">;</span>
    <span class="n">fbGearOut</span><span class="p">:</span> <span class="n">MC_GearOut</span><span class="p">;</span>
    <span class="n">fbExecuteRiseEdge</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">stAxisStatus</span><span class="p">:</span> <span class="n">DUT_AxisStatus_v0_01</span><span class="p">;</span>
    <span class="n">stAxisStatusV2</span><span class="p">:</span> <span class="n">DUT_AxisStatus_v0_01</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Transfer</span> <span class="n">nCommand</span> <span class="ow">and</span> <span class="n">nCmdData</span> <span class="n">to</span> <span class="n">local</span> <span class="n">copies</span> <span class="n">at</span> <span class="n">rising</span> <span class="n">edge</span> <span class="n">of</span> <span class="n">bExecute</span> <span class="p">(</span><span class="n">avoid</span> <span class="n">issues</span> <span class="k">if</span> <span class="n">nCommand</span> <span class="ow">or</span> <span class="n">nCmdData</span> <span class="n">are</span> <span class="n">changed</span> <span class="n">during</span> <span class="n">a</span> <span class="n">command</span><span class="p">)</span>
<span class="n">fbExecuteRiseEdge</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">);</span>
<span class="n">IF</span> <span class="n">fbExecuteRiseEdge</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
  <span class="n">nCmdDataLocal</span><span class="o">:=</span><span class="n">nCmdData</span><span class="p">;</span>
  <span class="n">nCommandLocal</span><span class="o">:=</span><span class="n">nCommand</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Hack</span><span class="p">,</span> <span class="n">we</span> <span class="n">can</span><span class="s1">&#39;t home these</span>
<span class="n">bHomed</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span><span class="o">//</span><span class="n">fbHomeVirtual</span><span class="o">.</span><span class="n">bHomed</span><span class="p">;</span> <span class="o">//</span><span class="n">Add</span> <span class="ow">in</span> <span class="n">DUT_AxisStatus</span> <span class="n">later</span>
<span class="n">bDone</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>

<span class="p">(</span><span class="o">*</span><span class="n">Reset</span><span class="o">*</span><span class="p">)</span>
<span class="n">fbReset</span><span class="p">(</span>
    <span class="n">Execute</span><span class="o">:=</span><span class="n">bReset</span> <span class="n">AND</span> <span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Done</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Busy</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Error</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">ErrorID</span><span class="o">=&gt;</span> <span class="p">);</span>

<span class="p">(</span><span class="o">*</span><span class="n">Power</span><span class="o">*</span><span class="p">)</span>
<span class="n">fbPower</span><span class="p">(</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span><span class="o">:=</span><span class="n">bEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span><span class="o">:=</span><span class="n">bEnable</span> <span class="n">AND</span> <span class="n">bLimitFwd</span><span class="p">,</span>
    <span class="n">Enable_Negative</span><span class="o">:=</span><span class="n">bEnable</span> <span class="n">AND</span> <span class="n">bLimitBwd</span><span class="p">,</span>
    <span class="n">Override</span><span class="o">:=</span><span class="n">fOverride</span><span class="p">,</span>
    <span class="n">BufferMode</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">Status</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Busy</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Active</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Error</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">ErrorID</span><span class="o">=&gt;</span> <span class="p">);</span>

<span class="p">(</span><span class="o">*</span><span class="n">Halt</span><span class="o">*</span><span class="p">)</span>
<span class="n">fbHalt</span><span class="p">(</span>
    <span class="n">Execute</span><span class="o">:=</span><span class="n">NOT</span> <span class="n">bExecute</span>  <span class="n">AND</span> <span class="p">(((</span><span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">Busy</span> <span class="n">OR</span> <span class="n">fbPower</span><span class="o">.</span><span class="n">Busy</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="n">OR</span> <span class="p">(</span><span class="n">fbMoveRelative</span><span class="o">.</span><span class="n">Busy</span> <span class="n">AND</span> <span class="p">(</span><span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span> <span class="n">OR</span> <span class="p">(</span><span class="n">fbMoveAbsolute</span><span class="o">.</span><span class="n">Busy</span> <span class="n">AND</span> <span class="p">(</span><span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span> <span class="n">OR</span> <span class="p">(</span><span class="n">fbMoveModulo</span><span class="o">.</span><span class="n">Busy</span> <span class="n">AND</span> <span class="p">(</span><span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span> <span class="n">OR</span> <span class="p">(</span><span class="n">fbHomeVirtual</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="p">(</span><span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">10</span><span class="p">))),</span>
    <span class="n">Deceleration</span><span class="o">:=</span><span class="n">fDeceleration</span><span class="p">,</span>
    <span class="n">Jerk</span><span class="o">:=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">BufferMode</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">Options</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span> <span class="p">,</span>
    <span class="n">Done</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Busy</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Active</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">CommandAborted</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Error</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">ErrorID</span><span class="o">=&gt;</span> <span class="p">);</span>

<span class="p">(</span><span class="o">*</span><span class="n">Jog</span> <span class="p">(</span><span class="n">Command</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="p">)</span>
<span class="n">fbJog</span><span class="p">(</span>
    <span class="n">JogForward</span><span class="o">:=</span><span class="n">bJogFwd</span> <span class="n">AND</span> <span class="p">(</span><span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">JogBackwards</span><span class="o">:=</span><span class="n">bJogBwd</span> <span class="n">AND</span> <span class="p">(</span><span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">Mode</span><span class="o">:=</span><span class="n">nCmdDataLocal</span><span class="p">,</span>
    <span class="n">Position</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">Velocity</span><span class="o">:=</span><span class="n">fVelocity</span><span class="p">,</span>
    <span class="n">Acceleration</span><span class="o">:=</span><span class="n">fAcceleration</span><span class="p">,</span>
    <span class="n">Deceleration</span><span class="o">:=</span><span class="n">fDeceleration</span><span class="p">,</span>
    <span class="n">Jerk</span><span class="o">:=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Done</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Busy</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Active</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">CommandAborted</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Error</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">ErrorID</span><span class="o">=&gt;</span> <span class="p">);</span>

<span class="p">(</span><span class="o">*</span><span class="n">MoveVelocity</span> <span class="p">(</span><span class="n">Command</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">)</span>
<span class="n">fbMoveVelocity</span><span class="p">(</span>
    <span class="n">Execute</span><span class="o">:=</span><span class="n">bExecute</span> <span class="n">AND</span> <span class="p">(</span><span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">Velocity</span><span class="o">:=</span><span class="n">ABS</span><span class="p">(</span><span class="n">fVelocity</span><span class="p">),</span>
    <span class="n">Acceleration</span><span class="o">:=</span><span class="n">fAcceleration</span><span class="p">,</span>
    <span class="n">Deceleration</span><span class="o">:=</span><span class="n">fDeceleration</span><span class="p">,</span>
    <span class="n">Jerk</span><span class="o">:=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">Direction</span><span class="o">:=</span><span class="n">SEL</span><span class="p">(</span><span class="n">fVelocity</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">MC_Positive_Direction</span><span class="p">,</span> <span class="n">MC_Negative_Direction</span><span class="p">),</span>
    <span class="n">BufferMode</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">Options</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">InVelocity</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Busy</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Active</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">CommandAborted</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Error</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">ErrorID</span><span class="o">=&gt;</span> <span class="p">);</span>

<span class="p">(</span><span class="o">*</span><span class="n">MoveRelative</span> <span class="p">(</span><span class="n">Command</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">)</span>
<span class="n">fbMoveRelative</span><span class="p">(</span>
    <span class="n">Execute</span><span class="o">:=</span><span class="n">bExecute</span> <span class="n">AND</span> <span class="p">(</span><span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">Distance</span><span class="o">:=</span><span class="n">fPosition</span><span class="p">,</span>
    <span class="n">Velocity</span><span class="o">:=</span><span class="n">ABS</span><span class="p">(</span><span class="n">fVelocity</span><span class="p">),</span>
    <span class="n">Acceleration</span><span class="o">:=</span><span class="n">fAcceleration</span><span class="p">,</span>
    <span class="n">Deceleration</span><span class="o">:=</span><span class="n">fDeceleration</span><span class="p">,</span>
    <span class="n">Jerk</span><span class="o">:=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">BufferMode</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">Options</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Done</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Busy</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Active</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">CommandAborted</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Error</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">ErrorID</span><span class="o">=&gt;</span> <span class="p">);</span>

<span class="n">IF</span> <span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">2</span> <span class="n">THEN</span>
    <span class="n">bDone</span><span class="o">:=</span><span class="n">fbMoveRelative</span><span class="o">.</span><span class="n">Done</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="p">(</span><span class="o">*</span><span class="n">MoveAbsolute</span> <span class="p">(</span><span class="n">Command</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="p">)</span>
<span class="n">fbMoveAbsolute</span><span class="p">(</span>
    <span class="n">Execute</span><span class="o">:=</span><span class="n">bExecute</span> <span class="n">AND</span> <span class="p">(</span><span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">Position</span><span class="o">:=</span><span class="n">fPosition</span><span class="p">,</span>
    <span class="n">Velocity</span><span class="o">:=</span><span class="n">ABS</span><span class="p">(</span><span class="n">fVelocity</span><span class="p">),</span>
    <span class="n">Acceleration</span><span class="o">:=</span><span class="n">fAcceleration</span><span class="p">,</span>
    <span class="n">Deceleration</span><span class="o">:=</span><span class="n">fDeceleration</span><span class="p">,</span>
    <span class="n">Jerk</span><span class="o">:=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">BufferMode</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">Options</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Done</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Busy</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Active</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">CommandAborted</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Error</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">ErrorID</span><span class="o">=&gt;</span> <span class="p">);</span>

<span class="n">IF</span> <span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">3</span> <span class="n">THEN</span>
    <span class="n">bDone</span><span class="o">:=</span><span class="n">fbMoveAbsolute</span><span class="o">.</span><span class="n">Done</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="p">(</span><span class="o">*</span><span class="n">MoveModulo</span> <span class="p">(</span><span class="n">Command</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="p">)</span>
<span class="n">fbMoveModulo</span><span class="p">(</span>
    <span class="n">Execute</span><span class="o">:=</span><span class="n">bExecute</span> <span class="n">AND</span> <span class="p">(</span><span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
    <span class="n">Position</span><span class="o">:=</span><span class="n">fPosition</span><span class="p">,</span>
    <span class="n">Velocity</span><span class="o">:=</span><span class="n">ABS</span><span class="p">(</span><span class="n">fVelocity</span><span class="p">),</span>
    <span class="n">Acceleration</span><span class="o">:=</span><span class="n">fAcceleration</span><span class="p">,</span>
    <span class="n">Deceleration</span><span class="o">:=</span><span class="n">fDeceleration</span><span class="p">,</span>
    <span class="n">Jerk</span><span class="o">:=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">Direction</span><span class="o">:=</span><span class="n">nCmdDataLocal</span><span class="p">,</span>
    <span class="n">BufferMode</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">Options</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Done</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Busy</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Active</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">CommandAborted</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Error</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">ErrorID</span><span class="o">=&gt;</span> <span class="p">);</span>

<span class="n">IF</span> <span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">4</span> <span class="n">THEN</span>
    <span class="n">bDone</span><span class="o">:=</span><span class="n">fbMoveModulo</span><span class="o">.</span><span class="n">Done</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="p">(</span><span class="o">*</span><span class="n">Home</span> <span class="p">(</span><span class="n">Command</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="p">)</span>
<span class="n">fbHomeVirtual</span><span class="p">(</span>
    <span class="n">bExecute</span><span class="o">:=</span> <span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">10</span> <span class="n">AND</span> <span class="n">bExecute</span><span class="p">,</span>
    <span class="n">fHomePosition</span><span class="o">:=</span><span class="n">fHomePosition</span><span class="p">,</span>
    <span class="n">bHomeSensor</span><span class="o">:=</span><span class="n">bHomeSensor</span><span class="p">,</span>
    <span class="n">bLimitBwd</span><span class="o">:=</span><span class="n">bLimitBwd</span><span class="p">,</span>
    <span class="n">bLimitFwd</span><span class="o">:=</span><span class="n">bLimitFwd</span><span class="p">,</span>
    <span class="n">nCmdData</span><span class="o">:=</span><span class="n">nCmdDataLocal</span><span class="p">,</span>
    <span class="n">bReset</span><span class="o">:=</span><span class="n">bReset</span><span class="p">,</span>
    <span class="n">nHomeRevOffset</span><span class="o">:=</span><span class="n">nHomeRevOffset</span><span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span>
    <span class="p">);</span>

<span class="n">IF</span> <span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">10</span> <span class="n">THEN</span>
    <span class="n">bDone</span><span class="o">:=</span><span class="n">fbHomeVirtual</span><span class="o">.</span><span class="n">bDone</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="p">(</span><span class="o">*</span><span class="n">Gear</span> <span class="p">(</span><span class="n">Command</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span><span class="o">*</span><span class="p">)</span>
<span class="n">fbGearInDyn</span><span class="p">(</span>
    <span class="n">Enable</span><span class="o">:=</span><span class="n">bExecute</span>  <span class="n">AND</span> <span class="p">(</span><span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
    <span class="n">GearRatio</span><span class="o">:=</span><span class="n">SEL</span><span class="p">(</span><span class="n">nCmdDataLocal</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">fVelocity</span><span class="p">),</span>
    <span class="n">Acceleration</span><span class="o">:=</span><span class="n">fAcceleration</span><span class="p">,</span>
    <span class="n">Deceleration</span><span class="o">:=</span><span class="n">fDeceleration</span><span class="p">,</span>
    <span class="n">Jerk</span><span class="o">:=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">BufferMode</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">Options</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">Master</span><span class="o">:=</span><span class="n">MasterAxis</span><span class="p">,</span>
    <span class="n">Slave</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">InGear</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Busy</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Active</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">CommandAborted</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Error</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">ErrorID</span><span class="o">=&gt;</span> <span class="p">);</span>

<span class="n">fbGearOut</span><span class="p">(</span>
    <span class="n">Execute</span><span class="o">:=</span><span class="n">NOT</span> <span class="n">bExecute</span> <span class="n">AND</span> <span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">NotMoving</span> <span class="n">AND</span> <span class="p">(</span><span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
    <span class="n">Slave</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Error</span><span class="o">=&gt;</span><span class="p">,</span>
    <span class="n">Done</span><span class="o">=&gt;</span><span class="p">,</span>
    <span class="n">ErrorID</span><span class="o">=&gt;</span><span class="p">);</span>


<span class="n">IF</span> <span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">30</span> <span class="n">THEN</span>
    <span class="n">bDone</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Coupled</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="p">(</span><span class="o">*</span><span class="n">Busy</span><span class="o">*</span><span class="p">)</span>
<span class="n">bBusy</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">HasJob</span> <span class="n">OR</span> <span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">HomingBusy</span> <span class="n">OR</span> <span class="n">fbHomeVirtual</span><span class="o">.</span><span class="n">bBusy</span><span class="p">;</span>

<span class="p">(</span><span class="o">*</span><span class="n">Enabled</span><span class="o">*</span><span class="p">)</span>
<span class="n">bEnabled</span><span class="o">:=</span><span class="n">fbPower</span><span class="o">.</span><span class="n">Status</span><span class="p">;</span>

<span class="p">(</span><span class="o">*</span><span class="n">Error</span> <span class="kn">from</span><span class="w"> </span><span class="nn">functions</span> <span class="ow">and</span> <span class="n">Nc</span><span class="o">*</span><span class="p">)</span>
<span class="n">IF</span> <span class="n">fbPower</span><span class="o">.</span><span class="n">Error</span> <span class="n">AND</span> <span class="n">fbPower</span><span class="o">.</span><span class="n">Active</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">fbPower</span><span class="o">.</span><span class="n">Enable</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbPower</span><span class="o">.</span><span class="n">ErrorID</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbHalt</span><span class="o">.</span><span class="n">Error</span> <span class="n">AND</span> <span class="n">fbHalt</span><span class="o">.</span><span class="n">Active</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">fbHalt</span><span class="o">.</span><span class="n">Execute</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbHalt</span><span class="o">.</span><span class="n">ErrorID</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbJog</span><span class="o">.</span><span class="n">Error</span> <span class="n">AND</span> <span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">0</span> <span class="p">(</span><span class="o">*</span><span class="n">fbJog</span><span class="o">.</span><span class="n">Active</span><span class="o">*</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">fbJog</span><span class="o">.</span><span class="n">JogForward</span> <span class="n">OR</span> <span class="n">fbJog</span><span class="o">.</span><span class="n">JogBackwards</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbJog</span><span class="o">.</span><span class="n">ErrorID</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">Error</span> <span class="n">AND</span> <span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">1</span><span class="p">(</span><span class="o">*</span><span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">Active</span><span class="o">*</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">Execute</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">ErrorID</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbMoveRelative</span><span class="o">.</span><span class="n">Error</span> <span class="n">AND</span> <span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">2</span> <span class="p">(</span><span class="o">*</span><span class="n">fbMoveRelative</span><span class="o">.</span><span class="n">Active</span><span class="o">*</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">fbMoveRelative</span><span class="o">.</span><span class="n">Execute</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbMoveRelative</span><span class="o">.</span><span class="n">ErrorID</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbMoveAbsolute</span><span class="o">.</span><span class="n">Error</span> <span class="n">AND</span> <span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">3</span> <span class="p">(</span><span class="o">*</span><span class="n">fbMoveAbsolute</span><span class="o">.</span><span class="n">Active</span><span class="o">*</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">fbMoveAbsolute</span><span class="o">.</span><span class="n">Execute</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbMoveAbsolute</span><span class="o">.</span><span class="n">ErrorID</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbMoveModulo</span><span class="o">.</span><span class="n">Error</span> <span class="n">AND</span> <span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">4</span> <span class="p">(</span><span class="o">*</span><span class="n">fbMoveModulo</span><span class="o">.</span><span class="n">Active</span><span class="o">*</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">fbMoveModulo</span><span class="o">.</span><span class="n">Execute</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbMoveModulo</span><span class="o">.</span><span class="n">ErrorID</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbHomeVirtual</span><span class="o">.</span><span class="n">bError</span> <span class="n">AND</span> <span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">10</span> <span class="p">(</span><span class="o">*</span><span class="n">fbHome</span><span class="o">.</span><span class="n">Active</span><span class="o">*</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">fbHomeVirtual</span><span class="o">.</span><span class="n">bError</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbHomeVirtual</span><span class="o">.</span><span class="n">nErrorID</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbGearInDyn</span><span class="o">.</span><span class="n">Error</span> <span class="n">AND</span> <span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">30</span> <span class="p">(</span><span class="o">*</span><span class="n">fbGearInDyn</span><span class="o">.</span><span class="n">Active</span><span class="o">*</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">fbGearInDyn</span><span class="o">.</span><span class="n">Enable</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbGearInDyn</span><span class="o">.</span><span class="n">ErrorID</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbGearOut</span><span class="o">.</span><span class="n">Error</span> <span class="n">AND</span> <span class="n">nCommandLocal</span><span class="o">=</span><span class="mi">30</span> <span class="n">AND</span> <span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Coupled</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">fbGearOut</span><span class="o">.</span><span class="n">Execute</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbGearOut</span><span class="o">.</span><span class="n">ErrorID</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Error</span>  <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">ErrorID</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbHomeVirtual</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbHomeVirtual</span><span class="o">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">ELSE</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span><span class="p">;</span>

<span class="p">(</span><span class="o">*</span><span class="n">Converese</span> <span class="n">nErrorID</span> <span class="n">to</span> <span class="n">string</span><span class="o">*</span><span class="p">)</span>
<span class="n">sErrorMessage</span><span class="o">:=</span><span class="n">WORD_TO_HEXSTR</span><span class="p">(</span><span class="ow">in</span><span class="o">:=</span><span class="n">TO_WORD</span><span class="p">(</span><span class="n">nErrorID</span><span class="p">)</span> <span class="p">,</span> <span class="n">iPrecision</span><span class="o">:=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">bLoCase</span><span class="o">:=</span><span class="mi">0</span> <span class="p">);</span>

<span class="p">(</span><span class="o">*</span><span class="n">Status</span> <span class="kn">from</span><span class="w"> </span><span class="nn">Nc</span><span class="o">*</span><span class="p">)</span>
<span class="n">Status</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="p">;</span>

<span class="p">(</span><span class="o">*</span><span class="n">Axis</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">motion</span> <span class="s2">&quot;motor&quot;</span><span class="o">*</span><span class="p">)</span>
<span class="n">nMotionAxisID</span><span class="o">:=</span><span class="n">axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">AxisId</span><span class="p">;</span>

<span class="p">(</span><span class="o">*</span><span class="n">Actual</span> <span class="n">Velocity</span><span class="o">*</span><span class="p">)</span>
<span class="n">fActVelocity</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActVelo</span><span class="p">;</span>

<span class="p">(</span><span class="o">*</span><span class="n">Actual</span> <span class="n">Position</span><span class="o">*</span><span class="p">)</span>
<span class="n">IF</span> <span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">OpMode</span><span class="o">.</span><span class="n">Modulo</span> <span class="n">THEN</span>
    <span class="n">fActPosition</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ModuloActPos</span><span class="p">;</span>
<span class="n">ELSE</span>
    <span class="n">fActPosition</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="p">(</span><span class="o">*</span><span class="n">Actual</span> <span class="n">Position</span><span class="o">*</span><span class="p">)</span>
<span class="n">fActDiff</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">PosDiff</span><span class="p">;</span>


<span class="o">//</span><span class="n">Status</span> <span class="n">struct</span> <span class="k">for</span> <span class="n">EPICS</span> <span class="n">communication</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">bEnable</span><span class="o">:=</span><span class="n">bEnable</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">bEnabled</span><span class="o">:=</span><span class="n">bEnabled</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">bError</span><span class="o">:=</span><span class="n">bError</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">bHomeSensor</span><span class="o">:=</span><span class="n">bHomeSensor</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">bJogBwd</span><span class="o">:=</span><span class="n">bJogBwd</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">bJogFwd</span><span class="o">:=</span><span class="n">bJogFwd</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">bLimitBwd</span><span class="o">:=</span><span class="n">bLimitBwd</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">bLimitFwd</span><span class="o">:=</span><span class="n">bLimitFwd</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">bReset</span><span class="o">:=</span><span class="n">bReset</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fAcceleration</span><span class="o">:=</span><span class="n">fAcceleration</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActDiff</span><span class="o">:=</span><span class="n">fActDiff</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="o">:=</span><span class="n">fActPosition</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActVelocity</span><span class="o">:=</span><span class="n">fActVelocity</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fDeceleration</span><span class="o">:=</span><span class="n">fDeceleration</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fOverride</span><span class="o">:=</span><span class="n">fOverride</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fPosition</span><span class="o">:=</span><span class="n">fPosition</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fVelocity</span><span class="o">:=</span><span class="n">fVelocity</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">nCmdData</span><span class="o">:=</span><span class="n">nCmdData</span><span class="p">;</span>  <span class="o">//</span><span class="n">Or</span> <span class="n">nCmdDataLocal</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">nCommand</span><span class="o">:=</span><span class="n">nCommand</span><span class="p">;</span>  <span class="o">//</span><span class="n">Or</span> <span class="n">nCommandLocal</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">nErrorId</span><span class="o">:=</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">bBusy</span><span class="o">:=</span><span class="n">bBusy</span><span class="p">;</span>
<span class="n">stAxisStatus</span><span class="o">.</span><span class="n">bHomed</span><span class="o">:=</span><span class="n">bHomed</span><span class="p">;</span>
<span class="n">stAxisStatusV2</span> <span class="o">:=</span> <span class="n">stAxisStatus</span><span class="p">;</span>

<span class="n">IF</span> <span class="n">bDone</span> <span class="n">THEN</span>
    <span class="n">bExecute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">IF</span> <span class="n">bFirstScan</span> <span class="n">THEN</span>
    <span class="n">bFirstScan</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#dut-axisstatus-v0-01">DUT_AxisStatus_v0_01</a></p></li>
<li><p><a class="reference internal" href="#fb-homevirtual">FB_HomeVirtual</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-homedirect">
<h2>FB_HomeDirect<a class="headerlink" href="#fb-homedirect" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_HomeDirect</span>
<span class="n">VAR_INPUT</span>
    <span class="n">En</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bReset</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">fHomePosition</span><span class="p">:</span><span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">Axis</span><span class="p">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">EnO</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bDone</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bHomed</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">fbHome</span><span class="p">:</span> <span class="n">MC_Home</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">En</span><span class="o">:=</span><span class="n">EnO</span><span class="p">;</span>
<span class="n">IF</span> <span class="n">bReset</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fbHome</span><span class="p">(</span>
    <span class="n">Execute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">,</span>
    <span class="n">Position</span><span class="o">:=</span><span class="n">fHomePosition</span><span class="p">,</span>
    <span class="n">HomingMode</span><span class="o">:=</span><span class="n">MC_Direct</span><span class="p">,</span>
    <span class="n">bCalibrationCam</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span>
    <span class="p">);</span>

<span class="n">bBusy</span><span class="o">:=</span><span class="n">fbHome</span><span class="o">.</span><span class="n">Busy</span><span class="p">;</span>
<span class="n">bDone</span><span class="o">:=</span><span class="n">fbHome</span><span class="o">.</span><span class="n">Done</span><span class="p">;</span>
<span class="n">bHomed</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Homed</span><span class="p">;</span>

<span class="n">bError</span><span class="o">:=</span><span class="n">fbHome</span><span class="o">.</span><span class="n">Error</span><span class="p">;</span>

<span class="n">IF</span> <span class="n">fbHome</span><span class="o">.</span><span class="n">Error</span> <span class="n">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbHome</span><span class="o">.</span><span class="n">ErrorID</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</section>
<section id="fb-homefinish">
<h2>FB_HomeFinish<a class="headerlink" href="#fb-homefinish" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_HomeFinish</span>
<span class="n">VAR_INPUT</span>
    <span class="n">En</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bReset</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nCmdData</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">bSofLimEnableLow</span><span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bSofLimEnableHigh</span><span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">Axis</span><span class="p">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">EnO</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bDone</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">fbHomewriteSoftLimEnable</span><span class="p">:</span><span class="n">FB_HomeWriteSoftLimEnable</span><span class="p">;</span>
    <span class="n">fbExecuteRiseEdge</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">bExecuteWriteNC</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">nState</span><span class="p">:</span><span class="n">INT</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">En</span><span class="o">:=</span><span class="n">EnO</span><span class="p">;</span>
<span class="n">IF</span> <span class="n">bReset</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="n">NOT</span> <span class="n">bExecute</span> <span class="n">THEN</span>
  <span class="n">bExecuteWriteNC</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
  <span class="n">fbHomewriteSoftLimEnable</span><span class="o">.</span><span class="n">bSofLimEnableLow</span><span class="o">:=</span><span class="n">bSofLimEnableLow</span><span class="p">;</span>
  <span class="n">fbHomewriteSoftLimEnable</span><span class="o">.</span><span class="n">bSofLimEnableHigh</span><span class="o">:=</span><span class="n">bSofLimEnableHigh</span><span class="p">;</span>
  <span class="n">nState</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fbExecuteRiseEdge</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">);</span>
<span class="n">IF</span> <span class="n">fbExecuteRiseEdge</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
  <span class="n">bExecuteWriteNC</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
  <span class="n">fbHomewriteSoftLimEnable</span><span class="o">.</span><span class="n">bSofLimEnableLow</span><span class="o">:=</span><span class="n">bSofLimEnableLow</span><span class="p">;</span>
  <span class="n">fbHomewriteSoftLimEnable</span><span class="o">.</span><span class="n">bSofLimEnableHigh</span><span class="o">:=</span><span class="n">bSofLimEnableHigh</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Write</span> <span class="n">to</span> <span class="n">NC</span> <span class="p">(</span><span class="n">disable</span> <span class="n">soft</span> <span class="n">limits</span><span class="p">)</span>
<span class="n">fbHomewriteSoftLimEnable</span><span class="p">(</span>
    <span class="n">En</span><span class="o">:=</span><span class="n">En</span><span class="p">,</span>
    <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecuteWriteNC</span> <span class="n">AND</span> <span class="n">bExecute</span><span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">bReset</span><span class="o">:=</span><span class="n">bReset</span><span class="p">,</span>
<span class="p">);</span>

<span class="n">bBusy</span><span class="o">:=</span><span class="n">fbHomewriteSoftLimEnable</span><span class="o">.</span><span class="n">bBusy</span><span class="p">;</span>
<span class="n">bDone</span><span class="o">:=</span><span class="n">fbHomewriteSoftLimEnable</span><span class="o">.</span><span class="n">bDone</span><span class="p">;</span>

<span class="n">bError</span><span class="o">:=</span><span class="n">fbHomewriteSoftLimEnable</span><span class="o">.</span><span class="n">bError</span><span class="p">;</span>
<span class="n">IF</span> <span class="n">fbHomewriteSoftLimEnable</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbHomewriteSoftLimEnable</span><span class="o">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-homewritesoftlimenable">FB_HomeWriteSoftLimEnable</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-homeprepare">
<h2>FB_HomePrepare<a class="headerlink" href="#fb-homeprepare" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_HomePrepare</span>
<span class="n">VAR_INPUT</span>
    <span class="n">En</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bReset</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nCmdData</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">Axis</span><span class="p">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">EnO</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bDone</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
    <span class="n">bSofLimEnableLowOriginal</span><span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bSofLimEnableHighOriginal</span><span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fVelocityToCam</span><span class="p">:</span> <span class="n">LREAL</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">fVelocityFromCam</span><span class="p">:</span> <span class="n">LREAL</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">fbHomeReadSoftLimEnable</span><span class="p">:</span><span class="n">FB_HomeReadSoftLimEnable</span><span class="p">;</span>
    <span class="n">fbHomeDisableSoftLimEnable</span><span class="p">:</span><span class="n">FB_HomeWriteSoftLimEnable</span><span class="p">;</span>
    <span class="n">fbHomeReadNCVelocities</span><span class="p">:</span> <span class="n">FB_HomeReadNcVelocities</span><span class="p">;</span>
    <span class="n">fbHomeResetCalibrationFlag</span><span class="p">:</span><span class="n">MC_Home</span><span class="p">;</span>   <span class="o">//</span><span class="n">Only</span> <span class="n">used</span> <span class="k">for</span> <span class="n">reset</span> <span class="n">of</span> <span class="n">calibration</span> <span class="n">flag</span>
    <span class="n">fbExecuteRiseEdge</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">bExecuteReadNC</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bExecuteWriteNC</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">nState</span><span class="p">:</span><span class="n">INT</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">En</span><span class="o">:=</span><span class="n">EnO</span><span class="p">;</span>
<span class="n">IF</span> <span class="n">bReset</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="n">NOT</span> <span class="n">bExecute</span> <span class="n">THEN</span>
  <span class="n">bExecuteReadNC</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
  <span class="n">bExecuteWriteNC</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
  <span class="n">nState</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fbExecuteRiseEdge</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">);</span>
<span class="n">IF</span> <span class="n">fbExecuteRiseEdge</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
  <span class="n">bExecuteReadNC</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Read</span> <span class="kn">from</span><span class="w"> </span><span class="nn">NC</span>
<span class="n">fbHomeReadNCVelocities</span><span class="p">(</span>
  <span class="n">En</span><span class="o">:=</span><span class="n">En</span><span class="p">,</span>
  <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecuteReadNC</span><span class="p">,</span> <span class="o">//</span> <span class="n">Actualy</span> <span class="ow">not</span> <span class="n">needed</span> <span class="k">for</span> <span class="n">sequence</span> <span class="mi">15</span> <span class="p">(</span><span class="nb">set</span> <span class="n">position</span> <span class="n">only</span><span class="p">,</span> <span class="n">no</span> <span class="n">movement</span><span class="p">))</span>
  <span class="n">bReset</span><span class="o">:=</span><span class="n">bReset</span><span class="p">,</span>
  <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
<span class="p">);</span>

<span class="n">fbHomeReadSoftLimEnable</span><span class="p">(</span>
    <span class="n">En</span><span class="o">:=</span><span class="n">En</span><span class="p">,</span>
    <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecuteReadNC</span> <span class="n">AND</span> <span class="n">bExecute</span><span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">bReset</span><span class="o">:=</span><span class="n">bReset</span><span class="p">,</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Reset</span> <span class="n">calibration</span> <span class="n">flag</span>
<span class="n">fbHomeResetCalibrationFlag</span><span class="p">(</span>
  <span class="n">Execute</span><span class="o">:=</span><span class="n">bExecuteReadNC</span><span class="p">,</span>
  <span class="n">HomingMode</span><span class="o">:=</span><span class="n">MC_ResetCalibration</span><span class="p">,</span>
  <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span>
<span class="p">);</span>

<span class="n">bSofLimEnableLowOriginal</span><span class="o">:=</span><span class="n">fbHomeReadSoftLimEnable</span><span class="o">.</span><span class="n">bSofLimEnableLow</span><span class="p">;</span>
<span class="n">bSofLimEnableHighOriginal</span><span class="o">:=</span><span class="n">fbHomeReadSoftLimEnable</span><span class="o">.</span><span class="n">bSofLimEnableHigh</span><span class="p">;</span>

<span class="n">fVelocityToCam</span><span class="o">:=</span><span class="n">fbHomeReadNCVelocities</span><span class="o">.</span><span class="n">fVelocityToCam</span><span class="p">;</span>
<span class="n">fVelocityFromCam</span><span class="o">:=</span><span class="n">fbHomeReadNCVelocities</span><span class="o">.</span><span class="n">fVelocityFromCam</span><span class="p">;</span>

<span class="n">IF</span> <span class="n">bExecuteReadNC</span> <span class="n">AND</span> <span class="n">bExecute</span> <span class="n">AND</span> <span class="n">fbHomeReadSoftLimEnable</span><span class="o">.</span><span class="n">bDone</span> <span class="n">THEN</span>
    <span class="n">fbHomeDisableSoftLimEnable</span><span class="o">.</span><span class="n">bSofLimEnableHigh</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">fbHomeDisableSoftLimEnable</span><span class="o">.</span><span class="n">bSofLimEnableLow</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bExecuteWriteNC</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span><span class="n">Always</span> <span class="n">write</span> <span class="p">(</span><span class="n">only</span> <span class="n">needed</span> <span class="k">if</span> <span class="n">enabled</span> <span class="n">actually</span><span class="p">)</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Write</span> <span class="n">to</span> <span class="n">NC</span> <span class="p">(</span><span class="n">disable</span> <span class="n">soft</span> <span class="n">limits</span><span class="p">)</span>
<span class="n">fbHomeDisableSoftLimEnable</span><span class="p">(</span>
    <span class="n">En</span><span class="o">:=</span><span class="n">En</span><span class="p">,</span>
    <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecuteWriteNC</span> <span class="n">AND</span> <span class="n">bExecute</span><span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">bReset</span><span class="o">:=</span><span class="n">bReset</span><span class="p">,</span>
<span class="p">);</span>

<span class="n">bBusy</span><span class="o">:=</span><span class="n">fbHomeReadSoftLimEnable</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">OR</span> <span class="n">fbHomeDisableSoftLimEnable</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">OR</span> <span class="n">fbHomeReadNCVelocities</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">OR</span> <span class="n">fbHomeResetCalibrationFlag</span><span class="o">.</span><span class="n">Busy</span><span class="p">;</span>
<span class="n">bDone</span><span class="o">:=</span><span class="n">fbHomeReadSoftLimEnable</span><span class="o">.</span><span class="n">bDone</span> <span class="n">AND</span> <span class="n">fbHomeDisableSoftLimEnable</span><span class="o">.</span><span class="n">bDone</span> <span class="n">AND</span> <span class="n">fbHomeReadNCVelocities</span><span class="o">.</span><span class="n">bDone</span> <span class="n">AND</span> <span class="n">fbHomeResetCalibrationFlag</span><span class="o">.</span><span class="n">Done</span> <span class="n">AND</span> <span class="n">bExecute</span><span class="p">;</span>

<span class="n">bError</span><span class="o">:=</span><span class="n">fbHomeReadSoftLimEnable</span><span class="o">.</span><span class="n">bError</span> <span class="n">OR</span> <span class="n">fbHomeDisableSoftLimEnable</span><span class="o">.</span><span class="n">bError</span> <span class="n">OR</span> <span class="n">fbHomeReadNCVelocities</span><span class="o">.</span><span class="n">bError</span> <span class="n">OR</span> <span class="n">fbHomeResetCalibrationFlag</span><span class="o">.</span><span class="n">Error</span><span class="p">;</span>
<span class="n">IF</span> <span class="n">fbHomeReadSoftLimEnable</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbHomeReadSoftLimEnable</span><span class="o">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbHomeDisableSoftLimEnable</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbHomeDisableSoftLimEnable</span><span class="o">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbHomeResetCalibrationFlag</span><span class="o">.</span><span class="n">Error</span> <span class="n">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbHomeResetCalibrationFlag</span><span class="o">.</span><span class="n">ErrorId</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-homereadncvelocities">FB_HomeReadNcVelocities</a></p></li>
<li><p><a class="reference internal" href="#fb-homereadsoftlimenable">FB_HomeReadSoftLimEnable</a></p></li>
<li><p><a class="reference internal" href="#fb-homewritesoftlimenable">FB_HomeWriteSoftLimEnable</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-homereadncvelocities">
<h2>FB_HomeReadNcVelocities<a class="headerlink" href="#fb-homereadncvelocities" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_HomeReadNcVelocities</span>
<span class="n">VAR_INPUT</span>
    <span class="n">En</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bReset</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">Axis</span><span class="p">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">EnO</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bDone</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
    <span class="n">fVelocityToCam</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fVelocityFromCam</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">fbReadVelocityToCam</span><span class="p">:</span><span class="n">FB_ReadFloatParameter</span><span class="p">;</span>
    <span class="n">fbReadVelocityFromCam</span><span class="p">:</span><span class="n">FB_ReadFloatParameter</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">En</span><span class="o">:=</span><span class="n">EnO</span><span class="p">;</span>
<span class="n">IF</span> <span class="n">bReset</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fbReadVelocityToCam</span><span class="p">(</span>
    <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">,</span>
    <span class="n">nDeviceGroup</span><span class="o">:=</span> <span class="mi">16</span><span class="c1">#4000,</span>
    <span class="n">nIndexOffset</span><span class="o">:=</span> <span class="mi">16</span><span class="c1">#6,</span>
    <span class="n">Axis</span><span class="o">:=</span> <span class="n">Axis</span><span class="p">);</span>

<span class="n">fbReadVelocityFromCam</span><span class="p">(</span>
    <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">,</span>
    <span class="n">nDeviceGroup</span><span class="o">:=</span> <span class="mi">16</span><span class="c1">#4000,</span>
    <span class="n">nIndexOffset</span><span class="o">:=</span> <span class="mi">16</span><span class="c1">#7,</span>
    <span class="n">Axis</span><span class="o">:=</span> <span class="n">Axis</span><span class="p">);</span>

<span class="n">fVelocityToCam</span><span class="o">:=</span><span class="n">fbReadVelocityToCam</span><span class="o">.</span><span class="n">nData</span><span class="p">;</span>
<span class="n">fVelocityFromCam</span><span class="o">:=</span><span class="n">fbReadVelocityFromCam</span><span class="o">.</span><span class="n">nData</span><span class="p">;</span>

<span class="n">bBusy</span><span class="o">:=</span><span class="n">fbReadVelocityFromCam</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">OR</span> <span class="n">fbReadVelocityToCam</span><span class="o">.</span><span class="n">bBusy</span><span class="p">;</span>
<span class="n">bDone</span><span class="o">:=</span><span class="n">fbReadVelocityFromCam</span><span class="o">.</span><span class="n">bDone</span> <span class="n">AND</span> <span class="n">fbReadVelocityToCam</span><span class="o">.</span><span class="n">bDone</span> <span class="n">AND</span> <span class="n">bExecute</span><span class="p">;</span>

<span class="n">bError</span><span class="o">:=</span><span class="n">fbReadVelocityToCam</span><span class="o">.</span><span class="n">bError</span> <span class="n">OR</span> <span class="n">fbReadVelocityFromCam</span><span class="o">.</span><span class="n">bError</span><span class="p">;</span>
<span class="n">IF</span> <span class="n">fbReadVelocityToCam</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbReadVelocityToCam</span><span class="o">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbReadVelocityFromCam</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbReadVelocityFromCam</span><span class="o">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-readfloatparameter">FB_ReadFloatParameter</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-homereadsoftlimenable">
<h2>FB_HomeReadSoftLimEnable<a class="headerlink" href="#fb-homereadsoftlimenable" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_HomeReadSoftLimEnable</span>
<span class="n">VAR_INPUT</span>
    <span class="n">En</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bReset</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">Axis</span><span class="p">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">EnO</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bDone</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
    <span class="n">bSofLimEnableLow</span><span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bSofLimEnableHigh</span><span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">fbReadSoftLimEnableLow</span><span class="p">:</span><span class="n">FB_ReadParameterInNc_v1_00</span><span class="p">;</span>
    <span class="n">fbReadSoftLimEnableHigh</span><span class="p">:</span><span class="n">FB_ReadParameterInNc_v1_00</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">En</span><span class="o">:=</span><span class="n">EnO</span><span class="p">;</span>
<span class="n">IF</span> <span class="n">bReset</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fbReadSoftLimEnableLow</span><span class="p">(</span>
    <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">,</span>
    <span class="n">nDeviceGroup</span><span class="o">:=</span> <span class="mi">16</span><span class="c1">#5000,</span>
    <span class="n">nIndexOffset</span><span class="o">:=</span> <span class="mi">16</span><span class="c1">#B,</span>
    <span class="n">Axis</span><span class="o">:=</span> <span class="n">Axis</span><span class="p">);</span>

<span class="n">fbReadSoftLimEnableHigh</span><span class="p">(</span>
    <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">,</span>
    <span class="n">nDeviceGroup</span><span class="o">:=</span> <span class="mi">16</span><span class="c1">#5000,</span>
    <span class="n">nIndexOffset</span><span class="o">:=</span> <span class="mi">16</span><span class="c1">#C,</span>
    <span class="n">Axis</span><span class="o">:=</span> <span class="n">Axis</span><span class="p">);</span>

<span class="n">bSofLimEnableLow</span><span class="o">:=</span><span class="n">DWORD_TO_BOOL</span><span class="p">(</span><span class="n">fbReadSoftLimEnableLow</span><span class="o">.</span><span class="n">nData</span><span class="p">);</span>
<span class="n">bSofLimEnableHigh</span><span class="o">:=</span><span class="n">DWORD_TO_BOOL</span><span class="p">(</span><span class="n">fbReadSoftLimEnableHigh</span><span class="o">.</span><span class="n">nData</span><span class="p">);</span>

<span class="n">bBusy</span><span class="o">:=</span><span class="n">fbReadSoftLimEnableLow</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">OR</span> <span class="n">fbReadSoftLimEnableHigh</span><span class="o">.</span><span class="n">bBusy</span><span class="p">;</span>
<span class="n">bDone</span><span class="o">:=</span><span class="n">fbReadSoftLimEnableLow</span><span class="o">.</span><span class="n">bDone</span> <span class="n">AND</span> <span class="n">fbReadSoftLimEnableHigh</span><span class="o">.</span><span class="n">bDone</span> <span class="n">AND</span> <span class="n">bExecute</span><span class="p">;</span>

<span class="n">bError</span><span class="o">:=</span><span class="n">fbReadSoftLimEnableLow</span><span class="o">.</span><span class="n">bError</span> <span class="n">OR</span> <span class="n">fbReadSoftLimEnableHigh</span><span class="o">.</span><span class="n">bError</span><span class="p">;</span>
<span class="n">IF</span> <span class="n">fbReadSoftLimEnableLow</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbReadSoftLimEnableLow</span><span class="o">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbReadSoftLimEnableHigh</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbReadSoftLimEnableHigh</span><span class="o">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-readparameterinnc-v1-00">FB_ReadParameterInNc_v1_00</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-hometoswitch">
<h2>FB_HomeToSwitch<a class="headerlink" href="#fb-hometoswitch" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_HomeToSwitch</span>
<span class="n">VAR_INPUT</span>
    <span class="n">En</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bReset</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bCamSensor</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nSearchDirTwoardsCam</span><span class="p">:</span> <span class="n">MC_Direction</span><span class="p">;</span>
    <span class="n">nSearchDirOffCam</span><span class="p">:</span> <span class="n">MC_Direction</span><span class="p">;</span>
    <span class="n">fHomePosition</span><span class="p">:</span><span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fVelocityToCamNC</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span> <span class="o">//</span><span class="n">Velcoity</span> <span class="n">when</span> <span class="n">searching</span> <span class="k">for</span> <span class="n">cam</span>
    <span class="n">fVelocityFromCamNC</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span> <span class="o">//</span> <span class="n">Velocity</span> <span class="n">after</span> <span class="n">found</span> <span class="n">cam</span> <span class="p">(</span><span class="n">searching</span> <span class="k">for</span> <span class="nb">next</span> <span class="n">signal</span> <span class="n">transition</span><span class="p">)</span>
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">Axis</span><span class="p">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">EnO</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bDone</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bHomed</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">fbHome</span><span class="p">:</span> <span class="n">MC_Home</span><span class="p">;</span>
    <span class="n">fbWriteHomeDirCamToNC</span><span class="p">:</span><span class="n">FB_WriteParameterInNc_v1_00</span><span class="p">;</span>
    <span class="n">fbWriteHomeDirSyncToNC</span><span class="p">:</span><span class="n">FB_WriteParameterInNc_v1_00</span><span class="p">;</span>
    <span class="n">fbWriteHomeModeToNC</span><span class="p">:</span><span class="n">FB_WriteParameterInNc_v1_00</span><span class="p">;</span>
    <span class="n">fbWriteHomeVelocitiesToNC</span><span class="p">:</span> <span class="n">FB_HomeWriteNcVelocities</span><span class="p">;</span>
    <span class="n">bConfigNCDone</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">fbRTrigg</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">En</span><span class="o">:=</span><span class="n">EnO</span><span class="p">;</span>
<span class="n">IF</span> <span class="n">bReset</span> <span class="n">THEN</span>
    <span class="n">bConfigNCDone</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span><span class="n">Start</span> <span class="n">preparation</span> <span class="n">of</span> <span class="n">NC</span> <span class="k">if</span> <span class="n">rising</span> <span class="n">edge</span> <span class="n">on</span> <span class="n">bExecute</span>
<span class="n">fbRTrigg</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">);</span>
<span class="n">IF</span> <span class="n">fbRTrigg</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
    <span class="n">bConfigNCDone</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="n">fbWriteHomeDirCamToNC</span><span class="p">(</span>
    <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bConfigNCDone</span><span class="p">,</span>
    <span class="n">nDeviceGroup</span><span class="o">:=</span><span class="mi">16</span><span class="c1">#5000,</span>
    <span class="n">nIndexOffset</span><span class="o">:=</span><span class="mi">16</span><span class="c1">#101,   //Direction for Calibration Cam Search</span>
    <span class="n">nData</span><span class="o">:=</span><span class="n">BOOL_TO_DWORD</span><span class="p">(</span><span class="n">nSearchDirTwoardsCam</span><span class="o">=</span><span class="n">MC_Negative_Direction</span><span class="p">),</span><span class="o">//</span><span class="n">BOOL_TO_DWORD</span><span class="p">(</span><span class="n">NOT</span> <span class="n">bSearchDirTwoardsCam</span><span class="p">),</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span>
<span class="p">);</span>

<span class="n">fbWriteHomeDirSyncToNC</span><span class="p">(</span>
    <span class="n">bExecute</span><span class="o">:=</span> <span class="n">bExecute</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bConfigNCDone</span><span class="p">,</span>
    <span class="n">nDeviceGroup</span><span class="o">:=</span><span class="mi">16</span><span class="c1">#5000 ,</span>
    <span class="n">nIndexOffset</span><span class="o">:=</span><span class="mi">16</span><span class="c1">#102 , //Direction for Sync Impuls Search</span>
    <span class="n">nData</span><span class="o">:=</span><span class="n">BOOL_TO_DWORD</span><span class="p">(</span><span class="n">nSearchDirOffCam</span><span class="o">=</span><span class="n">MC_Negative_Direction</span><span class="p">),</span><span class="o">//</span><span class="n">BOOL_TO_DWORD</span><span class="p">(</span><span class="n">NOT</span> <span class="n">bSearchDirOffCam</span><span class="p">),</span>
    <span class="n">Axis</span><span class="o">:=</span> <span class="n">Axis</span>
<span class="p">);</span>

<span class="n">fbWriteHomeModeToNC</span><span class="p">(</span>
    <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bConfigNCDone</span><span class="p">,</span>
    <span class="n">nDeviceGroup</span><span class="o">:=</span><span class="mi">16</span><span class="c1">#5000,</span>
    <span class="n">nIndexOffset</span><span class="o">:=</span><span class="mi">16</span><span class="c1">#107,  //Reference Mode</span>
    <span class="n">nData</span><span class="o">:=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">axis</span><span class="p">);</span>

<span class="n">fbWriteHomeVelocitiesToNC</span><span class="p">(</span>
  <span class="n">En</span><span class="o">:=</span><span class="n">En</span><span class="p">,</span>
  <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bConfigNCDone</span><span class="p">,</span>
  <span class="n">bReset</span><span class="o">:=</span><span class="n">bReset</span><span class="p">,</span>
  <span class="n">fVelocityFromCam</span><span class="o">:=</span><span class="n">fVelocityFromCamNC</span><span class="p">,</span>
  <span class="n">fVelocityToCam</span><span class="o">:=</span><span class="n">fVelocityToCamNC</span><span class="p">,</span>
  <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">);</span>

<span class="n">fbHome</span><span class="o">.</span><span class="n">bCalibrationCam</span><span class="o">:=</span><span class="n">bCamSensor</span><span class="p">;</span>

<span class="n">fbHome</span><span class="p">(</span>
    <span class="n">Execute</span><span class="o">:=</span><span class="n">bExecute</span> <span class="n">AND</span> <span class="n">bConfigNCDone</span><span class="p">(</span><span class="o">*</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bError</span><span class="o">*</span><span class="p">),</span>
    <span class="n">Position</span><span class="o">:=</span><span class="n">fHomePosition</span><span class="p">,</span>
    <span class="n">HomingMode</span><span class="o">:=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span>
    <span class="p">);</span>
<span class="n">bBusy</span><span class="o">:=</span><span class="p">(</span><span class="n">fbHome</span><span class="o">.</span><span class="n">Busy</span> <span class="n">OR</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">bConfigNCDone</span> <span class="n">AND</span> <span class="n">bExecute</span><span class="p">));</span>
<span class="n">bDone</span><span class="o">:=</span><span class="n">fbHome</span><span class="o">.</span><span class="n">Done</span> <span class="n">AND</span> <span class="n">bConfigNCDone</span><span class="p">;</span>
<span class="n">bHomed</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Homed</span><span class="p">;</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">bConfigNCDone</span><span class="p">)</span> <span class="n">AND</span> <span class="n">fbWriteHomeDirCamToNC</span><span class="o">.</span><span class="n">bDone</span> <span class="n">AND</span> <span class="n">fbWriteHomeDirSyncToNC</span><span class="o">.</span><span class="n">bDone</span> <span class="n">AND</span> <span class="n">fbWriteHomeModeToNC</span><span class="o">.</span><span class="n">bDone</span> <span class="n">AND</span> <span class="n">fbWriteHomeVelocitiesToNC</span><span class="o">.</span><span class="n">bDone</span> <span class="n">THEN</span>
  <span class="n">bConfigNCDone</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span><span class="n">For</span> <span class="n">some</span> <span class="n">reason</span> <span class="n">MC_HOME</span> <span class="n">gives</span> <span class="n">an</span> <span class="n">Error</span> <span class="k">for</span> <span class="n">one</span> <span class="n">cycle</span> <span class="n">of</span> <span class="n">NC</span><span class="o">-</span><span class="n">Task</span> <span class="mi">1</span> <span class="n">SVB</span> <span class="p">(</span><span class="mi">10</span><span class="n">ms</span> <span class="n">default</span><span class="o">..</span><span class="p">)</span> <span class="n">so</span> <span class="nb">filter</span> <span class="k">with</span> <span class="n">bExecute</span>
<span class="n">bError</span><span class="o">:=</span><span class="p">(</span><span class="n">fbHome</span><span class="o">.</span><span class="n">Error</span> <span class="n">AND</span> <span class="n">bExecute</span><span class="p">)</span> <span class="n">OR</span> <span class="n">fbWriteHomeDirCamToNC</span><span class="o">.</span><span class="n">bError</span> <span class="n">OR</span> <span class="n">fbWriteHomeDirSyncToNC</span><span class="o">.</span><span class="n">bError</span> <span class="n">OR</span> <span class="n">fbWriteHomeModeToNC</span><span class="o">.</span><span class="n">bError</span> <span class="n">OR</span> <span class="n">fbWriteHomeVelocitiesToNC</span><span class="o">.</span><span class="n">bError</span><span class="p">;</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">fbHome</span><span class="o">.</span><span class="n">Error</span> <span class="n">AND</span> <span class="n">bExecute</span><span class="p">)</span> <span class="n">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbHome</span><span class="o">.</span><span class="n">ErrorID</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbWriteHomeDirCamToNC</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbWriteHomeDirCamToNC</span><span class="o">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbWriteHomeDirSyncToNC</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbWriteHomeDirSyncToNC</span><span class="o">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbWriteHomeModeToNC</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbWriteHomeModeToNC</span><span class="o">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbWriteHomeVelocitiesToNC</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbWriteHomeVelocitiesToNC</span><span class="o">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-homewritencvelocities">FB_HomeWriteNcVelocities</a></p></li>
<li><p><a class="reference internal" href="#fb-writeparameterinnc-v1-00">FB_WriteParameterInNc_v1_00</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-homevirtual">
<h2>FB_HomeVirtual<a class="headerlink" href="#fb-homevirtual" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_HomeVirtual</span>
<span class="n">VAR_INPUT</span>
    <span class="n">En</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bReset</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nCmdData</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">bLimitFwd</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bLimitBwd</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bHomeSensor</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">fHomePosition</span><span class="p">:</span><span class="n">LREAL</span><span class="p">;</span>
    <span class="n">nHomeRevOffset</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">Axis</span><span class="p">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">EnO</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bDone</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bHomed</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">fbHomeToSwitch</span><span class="p">:</span> <span class="n">FB_HomeToSwitch</span><span class="p">;</span>
    <span class="n">fbHomeDirect</span><span class="p">:</span> <span class="n">FB_HomeDirect</span><span class="p">;</span> <span class="o">//</span><span class="n">Only</span> <span class="n">used</span> <span class="k">for</span> <span class="n">direct</span> <span class="n">homing</span> <span class="p">(</span><span class="nb">set</span> <span class="n">of</span> <span class="n">position</span><span class="p">)</span>
    <span class="n">fbMoveVelocity</span><span class="p">:</span><span class="n">MC_MoveVelocity</span><span class="p">;</span>
    <span class="n">fbHomePrepare</span><span class="p">:</span><span class="n">FB_HomePrepare</span><span class="p">;</span>
    <span class="n">fbHomeFinish</span><span class="p">:</span><span class="n">FB_HomeFinish</span><span class="p">;</span>
    <span class="n">fbExecuteRiseEdge</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">nHomingState</span><span class="p">:</span><span class="n">INT</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">bExecuteHomeToSwitch</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bExecuteMoveVelocity</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bExecutePrepare</span><span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bExecuteFinish</span><span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bExecuteHomeDirect</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nCmdDataLocal</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>  <span class="o">//</span><span class="n">Ensure</span> <span class="n">that</span> <span class="n">nCmdData</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">changed</span> <span class="n">during</span> <span class="n">sequence</span>
    <span class="n">bSequenceReady</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bRestoreNCDataNeeded</span><span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>

<span class="n">IF</span> <span class="n">bReset</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Reset</span> <span class="n">when</span> <span class="n">bExecute</span> <span class="ow">is</span> <span class="n">low</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="n">bExecute</span> <span class="n">THEN</span>
  <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
  <span class="n">bSequenceReady</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
  <span class="n">bExecuteHomeToSwitch</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
  <span class="n">bExecuteHomeDirect</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
  <span class="n">bExecuteMoveVelocity</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
  <span class="n">bExecutePrepare</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
  <span class="n">bExecuteFinish</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span><span class="n">Reset</span> <span class="n">at</span> <span class="n">rinsing</span> <span class="n">edge</span> <span class="n">of</span> <span class="n">bExecute</span>
<span class="n">fbExecuteRiseEdge</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">);</span>
<span class="n">IF</span> <span class="n">fbExecuteRiseEdge</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
  <span class="n">nCmdDataLocal</span><span class="o">:=</span><span class="n">nCmdData</span><span class="p">;</span> <span class="o">//</span><span class="n">Ensure</span> <span class="n">that</span> <span class="n">nCmdData</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">changed</span> <span class="n">during</span> <span class="n">sequence</span> <span class="p">(</span><span class="n">nCmdData</span> <span class="n">will</span> <span class="n">only</span> <span class="n">be</span> <span class="n">read</span> <span class="n">at</span> <span class="n">a</span> <span class="n">rising</span> <span class="n">edge</span> <span class="n">of</span> <span class="n">bExecute</span><span class="p">)</span>
  <span class="n">bSequenceReady</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
  <span class="n">bExecutePrepare</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
  <span class="n">bRestoreNCDataNeeded</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
  <span class="o">//</span><span class="n">Check</span> <span class="k">if</span> <span class="n">valid</span> <span class="n">nCmdDataLocal</span>
  <span class="n">CASE</span> <span class="n">nCmdDataLocal</span> <span class="n">OF</span>
    <span class="mi">1</span><span class="p">:</span>
    <span class="mi">2</span><span class="p">:</span>
    <span class="mi">3</span><span class="p">:</span>
    <span class="mi">4</span><span class="p">:</span>
    <span class="mi">15</span><span class="p">:</span>
    <span class="n">ELSE</span> <span class="o">//</span><span class="n">nCmdData</span> <span class="ow">not</span> <span class="n">valid</span>
      <span class="n">bError</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
      <span class="n">nErrorId</span><span class="o">:=</span><span class="mi">16</span><span class="c1">#4FFF;</span>
  <span class="n">END_CASE</span>
<span class="n">END_IF</span>

<span class="o">//</span><span class="c1">############# Prepare for homing (Read from NC and reset homed flag)</span>
<span class="n">fbHomePrepare</span><span class="p">(</span>
  <span class="n">En</span><span class="o">:=</span><span class="n">En</span><span class="p">,</span>
  <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecutePrepare</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bError</span><span class="p">,</span> <span class="o">//</span> <span class="n">Not</span> <span class="n">needed</span> <span class="k">for</span> <span class="n">sequence</span> <span class="mi">15</span> <span class="p">(</span><span class="nb">set</span> <span class="n">position</span> <span class="n">only</span><span class="p">,</span> <span class="n">no</span> <span class="n">movement</span><span class="p">))</span>
  <span class="n">bReset</span><span class="o">:=</span><span class="n">bReset</span><span class="p">,</span>
  <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
<span class="p">);</span>

<span class="o">//</span><span class="c1">############# Homing Sequences:</span>
<span class="n">CASE</span> <span class="n">nCmdDataLocal</span> <span class="n">OF</span>

   <span class="mi">1</span><span class="p">:</span> <span class="o">//</span> <span class="n">Home</span> <span class="n">to</span> <span class="n">low</span> <span class="n">limit</span> <span class="n">switch</span>
       <span class="n">CASE</span> <span class="n">nHomingState</span> <span class="n">OF</span>
              <span class="mi">0</span><span class="p">:</span>
                <span class="n">bHomed</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Homed</span><span class="p">;</span>
            <span class="o">//</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">read</span> <span class="n">of</span> <span class="n">velocities</span> <span class="kn">from</span><span class="w"> </span><span class="nn">NC</span> <span class="ow">and</span> <span class="n">reset</span> <span class="n">of</span> <span class="n">calibration</span> <span class="n">flag</span>
            <span class="n">IF</span> <span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">bDone</span> <span class="n">AND</span> <span class="n">bExecute</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bSequenceReady</span> <span class="n">THEN</span>
                      <span class="n">bRestoreNCDataNeeded</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
                      <span class="n">IF</span> <span class="n">bLimitBwd</span> <span class="n">THEN</span>
                <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
              <span class="n">ELSE</span>
                            <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">2</span><span class="p">;</span>  <span class="o">//</span><span class="n">Standing</span> <span class="n">on</span> <span class="n">limit</span> <span class="n">switch</span> <span class="n">go</span> <span class="n">direct</span> <span class="n">to</span> <span class="n">state</span> <span class="mi">2</span>
              <span class="n">END_IF</span>
            <span class="n">END_IF</span>
              <span class="mi">1</span><span class="p">:</span> <span class="o">//</span> <span class="n">wait</span> <span class="k">for</span> <span class="n">reach</span> <span class="n">low</span> <span class="n">limit</span> <span class="n">then</span> <span class="n">trigger</span> <span class="n">fbHomeToSwitch</span>
                <span class="n">bHomed</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
                    <span class="n">bSequenceReady</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
                    <span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">Velocity</span><span class="o">:=</span><span class="n">ABS</span><span class="p">(</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">fVelocityToCam</span><span class="p">);</span>
            <span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">Direction</span><span class="o">:=</span><span class="n">MC_Negative_Direction</span><span class="p">;</span>
            <span class="n">bExecuteMoveVelocity</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">;</span>  <span class="o">//</span> <span class="n">Execute</span> <span class="n">MC_MoveVelocity</span>
                <span class="n">IF</span> <span class="n">NOT</span> <span class="n">bLimitBwd</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">Busy</span> <span class="n">AND</span> <span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">NotMoving</span> <span class="n">THEN</span> <span class="o">//</span><span class="n">MC_MoveVelocity</span><span class="o">.</span><span class="n">Busy</span> <span class="n">goes</span> <span class="n">down</span> <span class="n">when</span> <span class="n">ramp</span> <span class="n">down</span> <span class="n">initiates</span> <span class="p">(</span><span class="ow">not</span> <span class="n">ends</span><span class="p">)</span><span class="o">.</span>
                      <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">2</span><span class="p">;</span>
                <span class="n">END_IF</span>
              <span class="mi">2</span><span class="p">:</span> <span class="o">//</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">fbHomeToSwitch</span>
                <span class="n">bHomed</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
                <span class="n">bSequenceReady</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">bExecuteMoveVelocity</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">bExecuteHomeToSwitch</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
            <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">nSearchDirTwoardsCam</span><span class="o">:=</span><span class="n">MC_Positive_Direction</span><span class="p">;</span>
            <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">nSearchDirOffCam</span><span class="o">:=</span><span class="n">MC_Positive_Direction</span><span class="p">;</span>
            <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">fVelocityToCamNC</span><span class="o">:=</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">fVelocityToCam</span><span class="p">;</span> <span class="o">//</span> <span class="n">High</span> <span class="n">speed</span>
            <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">fVelocityFromCamNC</span><span class="o">:=</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">fVelocityFromCam</span><span class="p">;</span>  <span class="o">//</span> <span class="n">Low</span> <span class="n">speed</span>
                <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">bCamSensor</span><span class="o">:=</span><span class="n">NOT</span> <span class="n">bLimitBwd</span><span class="p">;</span>
            <span class="n">IF</span> <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">bDone</span> <span class="n">THEN</span>
                      <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">3</span><span class="p">;</span>
                      <span class="n">bExecuteFinish</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
                      <span class="n">fbHomeFinish</span><span class="o">.</span><span class="n">bSofLimEnableHigh</span><span class="o">:=</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">bSofLimEnableHighOriginal</span><span class="p">;</span>
                      <span class="n">fbHomeFinish</span><span class="o">.</span><span class="n">bSofLimEnableLow</span><span class="o">:=</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">bSofLimEnableLowOriginal</span><span class="p">;</span>
            <span class="n">END_IF</span><span class="p">;</span>
          <span class="mi">3</span><span class="p">:</span> <span class="o">//</span> <span class="n">restore</span> <span class="n">softlimit</span> <span class="n">enable</span>
            <span class="n">bHomed</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
                <span class="n">bSequenceReady</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">IF</span> <span class="n">fbHomeFinish</span><span class="o">.</span><span class="n">bDone</span> <span class="n">THEN</span>
                      <span class="n">bRestoreNCDataNeeded</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
              <span class="n">bSequenceReady</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
                      <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
                      <span class="n">bHomed</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Homed</span><span class="p">;</span>
            <span class="n">END_IF</span><span class="p">;</span>
       <span class="n">END_CASE</span><span class="p">;</span>

   <span class="mi">2</span><span class="p">:</span> <span class="o">//</span> <span class="n">Home</span> <span class="n">to</span> <span class="n">high</span> <span class="n">limit</span> <span class="n">switch</span>
       <span class="n">CASE</span> <span class="n">nHomingState</span> <span class="n">OF</span>
              <span class="mi">0</span><span class="p">:</span>
                <span class="n">bHomed</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Homed</span><span class="p">;</span>
            <span class="o">//</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">read</span> <span class="n">of</span> <span class="n">velocities</span> <span class="kn">from</span><span class="w"> </span><span class="nn">NC</span> <span class="ow">and</span> <span class="n">reset</span> <span class="n">of</span> <span class="n">calibration</span> <span class="n">flag</span>
            <span class="n">IF</span> <span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">bDone</span> <span class="n">AND</span> <span class="n">bExecute</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bSequenceReady</span> <span class="n">THEN</span>
                      <span class="n">bRestoreNCDataNeeded</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
                      <span class="n">IF</span> <span class="n">bLimitFwd</span> <span class="n">THEN</span>
                <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
              <span class="n">ELSE</span>
                            <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">2</span><span class="p">;</span>  <span class="o">//</span><span class="n">Standing</span> <span class="n">on</span> <span class="n">limit</span> <span class="n">switch</span> <span class="n">go</span> <span class="n">direct</span> <span class="n">to</span> <span class="n">state</span> <span class="mi">2</span>
              <span class="n">END_IF</span>
            <span class="n">END_IF</span>
              <span class="mi">1</span><span class="p">:</span> <span class="o">//</span> <span class="n">wait</span> <span class="k">for</span> <span class="n">reach</span> <span class="n">low</span> <span class="n">limit</span> <span class="n">then</span> <span class="n">trigger</span> <span class="n">fbHomeToSwitch</span>
                <span class="n">bHomed</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
                    <span class="n">bSequenceReady</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
                    <span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">Velocity</span><span class="o">:=</span><span class="n">ABS</span><span class="p">(</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">fVelocityToCam</span><span class="p">);</span>
            <span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">Direction</span><span class="o">:=</span><span class="n">MC_Positive_Direction</span><span class="p">;</span>
            <span class="n">bExecuteMoveVelocity</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">;</span>  <span class="o">//</span> <span class="n">Execute</span> <span class="n">MC_MoveVelocity</span>
                <span class="n">IF</span> <span class="n">NOT</span> <span class="n">bLimitFwd</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">Busy</span> <span class="n">AND</span> <span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">NotMoving</span> <span class="n">THEN</span> <span class="o">//</span><span class="n">MC_MoveVelocity</span><span class="o">.</span><span class="n">Busy</span> <span class="n">goes</span> <span class="n">down</span> <span class="n">when</span> <span class="n">ramp</span> <span class="n">down</span> <span class="n">initiates</span> <span class="p">(</span><span class="ow">not</span> <span class="n">ends</span><span class="p">)</span><span class="o">.</span>
                      <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">2</span><span class="p">;</span>
                <span class="n">END_IF</span>
              <span class="mi">2</span><span class="p">:</span> <span class="o">//</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">fbHomeToSwitch</span>
                <span class="n">bHomed</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
                <span class="n">bSequenceReady</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">bExecuteMoveVelocity</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">bExecuteHomeToSwitch</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
            <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">nSearchDirTwoardsCam</span><span class="o">:=</span><span class="n">MC_Negative_Direction</span><span class="p">;</span>
            <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">nSearchDirOffCam</span><span class="o">:=</span><span class="n">MC_Negative_Direction</span><span class="p">;</span>
            <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">fVelocityToCamNC</span><span class="o">:=</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">fVelocityToCam</span><span class="p">;</span> <span class="o">//</span> <span class="n">High</span> <span class="n">speed</span>
            <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">fVelocityFromCamNC</span><span class="o">:=</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">fVelocityFromCam</span><span class="p">;</span>  <span class="o">//</span> <span class="n">Low</span> <span class="n">speed</span>
                <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">bCamSensor</span><span class="o">:=</span><span class="n">NOT</span> <span class="n">bLimitFwd</span><span class="p">;</span>
            <span class="n">IF</span> <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">bDone</span> <span class="n">THEN</span>
                      <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">3</span><span class="p">;</span>
                      <span class="n">bExecuteFinish</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
                      <span class="n">fbHomeFinish</span><span class="o">.</span><span class="n">bSofLimEnableHigh</span><span class="o">:=</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">bSofLimEnableHighOriginal</span><span class="p">;</span>
                      <span class="n">fbHomeFinish</span><span class="o">.</span><span class="n">bSofLimEnableLow</span><span class="o">:=</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">bSofLimEnableLowOriginal</span><span class="p">;</span>
            <span class="n">END_IF</span><span class="p">;</span>
          <span class="mi">3</span><span class="p">:</span> <span class="o">//</span> <span class="n">restore</span> <span class="n">softlimit</span> <span class="n">enable</span>
            <span class="n">bHomed</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
                <span class="n">bSequenceReady</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">IF</span> <span class="n">fbHomeFinish</span><span class="o">.</span><span class="n">bDone</span> <span class="n">THEN</span>
                      <span class="n">bRestoreNCDataNeeded</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
              <span class="n">bSequenceReady</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
                      <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
                      <span class="n">bHomed</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Homed</span><span class="p">;</span>
            <span class="n">END_IF</span><span class="p">;</span>
       <span class="n">END_CASE</span><span class="p">;</span>

   <span class="mi">3</span><span class="p">:</span> <span class="o">//</span> <span class="n">Home</span> <span class="n">on</span> <span class="n">bHomeSensor</span> <span class="n">via</span> <span class="n">bLimitBwd</span>
       <span class="n">CASE</span> <span class="n">nHomingState</span> <span class="n">OF</span>
              <span class="mi">0</span><span class="p">:</span>
                <span class="n">bHomed</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Homed</span><span class="p">;</span>
            <span class="o">//</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">read</span> <span class="n">of</span> <span class="n">velocities</span> <span class="kn">from</span><span class="w"> </span><span class="nn">NC</span> <span class="ow">and</span> <span class="n">reset</span> <span class="n">of</span> <span class="n">calibration</span> <span class="n">flag</span>
            <span class="n">IF</span> <span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">bDone</span> <span class="n">AND</span> <span class="n">bExecute</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bSequenceReady</span> <span class="n">THEN</span>
                      <span class="n">bRestoreNCDataNeeded</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
                      <span class="n">IF</span> <span class="n">bLimitBwd</span> <span class="n">THEN</span>
                <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
              <span class="n">ELSE</span>
                            <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">2</span><span class="p">;</span>  <span class="o">//</span><span class="n">Standing</span> <span class="n">on</span> <span class="n">limit</span> <span class="n">switch</span> <span class="n">go</span> <span class="n">direct</span> <span class="n">to</span> <span class="n">state</span> <span class="mi">2</span>
              <span class="n">END_IF</span>
            <span class="n">END_IF</span>
              <span class="mi">1</span><span class="p">:</span> <span class="o">//</span> <span class="n">wait</span> <span class="k">for</span> <span class="n">reach</span> <span class="n">low</span> <span class="n">limit</span> <span class="n">then</span> <span class="n">trigger</span> <span class="n">fbHomeToSwitch</span>
                <span class="n">bHomed</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
                    <span class="n">bSequenceReady</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
                    <span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">Velocity</span><span class="o">:=</span><span class="n">ABS</span><span class="p">(</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">fVelocityToCam</span><span class="p">);</span>
            <span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">Direction</span><span class="o">:=</span><span class="n">MC_Negative_Direction</span><span class="p">;</span>
            <span class="n">bExecuteMoveVelocity</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">;</span>  <span class="o">//</span> <span class="n">Execute</span> <span class="n">MC_MoveVelocity</span>
                <span class="n">IF</span> <span class="n">NOT</span> <span class="n">bLimitBwd</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">Busy</span> <span class="n">AND</span> <span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">NotMoving</span> <span class="n">THEN</span> <span class="o">//</span><span class="n">MC_MoveVelocity</span><span class="o">.</span><span class="n">Busy</span> <span class="n">goes</span> <span class="n">down</span> <span class="n">when</span> <span class="n">ramp</span> <span class="n">down</span> <span class="n">initiates</span> <span class="p">(</span><span class="ow">not</span> <span class="n">ends</span><span class="p">)</span><span class="o">.</span>
                      <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">2</span><span class="p">;</span>
                <span class="n">END_IF</span>
              <span class="mi">2</span><span class="p">:</span> <span class="o">//</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">fbHomeToSwitch</span>
                <span class="n">bHomed</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
                <span class="n">bSequenceReady</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">bExecuteMoveVelocity</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">bExecuteHomeToSwitch</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
            <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">nSearchDirTwoardsCam</span><span class="o">:=</span><span class="n">MC_Positive_Direction</span><span class="p">;</span>
            <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">nSearchDirOffCam</span><span class="o">:=</span><span class="n">MC_Positive_Direction</span><span class="p">;</span>
            <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">fVelocityToCamNC</span><span class="o">:=</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">fVelocityToCam</span><span class="p">;</span> <span class="o">//</span> <span class="n">High</span> <span class="n">speed</span>
            <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">fVelocityFromCamNC</span><span class="o">:=</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">fVelocityFromCam</span><span class="p">;</span>  <span class="o">//</span> <span class="n">Low</span> <span class="n">speed</span>
                <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">bCamSensor</span><span class="o">:=</span><span class="n">bHomeSensor</span><span class="p">;</span>
            <span class="n">IF</span> <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">bDone</span> <span class="n">THEN</span>
                      <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">3</span><span class="p">;</span>
                      <span class="n">bExecuteFinish</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
                      <span class="n">fbHomeFinish</span><span class="o">.</span><span class="n">bSofLimEnableHigh</span><span class="o">:=</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">bSofLimEnableHighOriginal</span><span class="p">;</span>
                      <span class="n">fbHomeFinish</span><span class="o">.</span><span class="n">bSofLimEnableLow</span><span class="o">:=</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">bSofLimEnableLowOriginal</span><span class="p">;</span>
            <span class="n">END_IF</span><span class="p">;</span>
          <span class="mi">3</span><span class="p">:</span> <span class="o">//</span> <span class="n">restore</span> <span class="n">softlimit</span> <span class="n">enable</span>
            <span class="n">bHomed</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
                <span class="n">bSequenceReady</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">IF</span> <span class="n">fbHomeFinish</span><span class="o">.</span><span class="n">bDone</span> <span class="n">THEN</span>
                  <span class="n">bRestoreNCDataNeeded</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
              <span class="n">bSequenceReady</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
                      <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
                      <span class="n">bHomed</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Homed</span><span class="p">;</span>
            <span class="n">END_IF</span><span class="p">;</span>
       <span class="n">END_CASE</span><span class="p">;</span>
    <span class="mi">4</span><span class="p">:</span>  <span class="o">//</span> <span class="n">Home</span> <span class="n">on</span> <span class="n">bHomeSensor</span> <span class="n">via</span> <span class="n">bLimitFwd</span>
       <span class="n">CASE</span> <span class="n">nHomingState</span> <span class="n">OF</span>
              <span class="mi">0</span><span class="p">:</span>
                <span class="n">bHomed</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Homed</span><span class="p">;</span>
            <span class="o">//</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">read</span> <span class="n">of</span> <span class="n">velocities</span> <span class="kn">from</span><span class="w"> </span><span class="nn">NC</span> <span class="ow">and</span> <span class="n">reset</span> <span class="n">of</span> <span class="n">calibration</span> <span class="n">flag</span>
            <span class="n">IF</span> <span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">bDone</span> <span class="n">AND</span> <span class="n">bExecute</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bSequenceReady</span> <span class="n">THEN</span>
                      <span class="n">bRestoreNCDataNeeded</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
                      <span class="n">IF</span> <span class="n">bLimitFwd</span> <span class="n">THEN</span>
                <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
              <span class="n">ELSE</span>
                            <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">2</span><span class="p">;</span>  <span class="o">//</span><span class="n">Standing</span> <span class="n">on</span> <span class="n">limit</span> <span class="n">switch</span> <span class="n">go</span> <span class="n">direct</span> <span class="n">to</span> <span class="n">state</span> <span class="mi">2</span>
              <span class="n">END_IF</span>
            <span class="n">END_IF</span>
              <span class="mi">1</span><span class="p">:</span> <span class="o">//</span> <span class="n">wait</span> <span class="k">for</span> <span class="n">reach</span> <span class="n">low</span> <span class="n">limit</span> <span class="n">then</span> <span class="n">trigger</span> <span class="n">fbHomeToSwitch</span>
                <span class="n">bHomed</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
                    <span class="n">bSequenceReady</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
                    <span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">Velocity</span><span class="o">:=</span><span class="n">ABS</span><span class="p">(</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">fVelocityToCam</span><span class="p">);</span>
            <span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">Direction</span><span class="o">:=</span><span class="n">MC_Positive_Direction</span><span class="p">;</span>
            <span class="n">bExecuteMoveVelocity</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">;</span>  <span class="o">//</span> <span class="n">Execute</span> <span class="n">MC_MoveVelocity</span>
                <span class="n">IF</span> <span class="n">NOT</span> <span class="n">bLimitFwd</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">Busy</span> <span class="n">AND</span> <span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">NotMoving</span> <span class="n">THEN</span> <span class="o">//</span><span class="n">MC_MoveVelocity</span><span class="o">.</span><span class="n">Busy</span> <span class="n">goes</span> <span class="n">down</span> <span class="n">when</span> <span class="n">ramp</span> <span class="n">down</span> <span class="n">initiates</span> <span class="p">(</span><span class="ow">not</span> <span class="n">ends</span><span class="p">)</span><span class="o">.</span>
                      <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">2</span><span class="p">;</span>
                <span class="n">END_IF</span>
              <span class="mi">2</span><span class="p">:</span> <span class="o">//</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">fbHomeToSwitch</span>
                <span class="n">bHomed</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
                <span class="n">bSequenceReady</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">bExecuteMoveVelocity</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">bExecuteHomeToSwitch</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
            <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">nSearchDirTwoardsCam</span><span class="o">:=</span><span class="n">MC_Negative_Direction</span><span class="p">;</span>
            <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">nSearchDirOffCam</span><span class="o">:=</span><span class="n">MC_Negative_Direction</span><span class="p">;</span>
            <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">fVelocityToCamNC</span><span class="o">:=</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">fVelocityToCam</span><span class="p">;</span> <span class="o">//</span> <span class="n">High</span> <span class="n">speed</span>
            <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">fVelocityFromCamNC</span><span class="o">:=</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">fVelocityFromCam</span><span class="p">;</span>  <span class="o">//</span> <span class="n">Low</span> <span class="n">speed</span>
                <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">bCamSensor</span><span class="o">:=</span><span class="n">bHomeSensor</span><span class="p">;</span>
            <span class="n">IF</span> <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">bDone</span> <span class="n">THEN</span>
                      <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">3</span><span class="p">;</span>
                      <span class="n">bExecuteFinish</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
                      <span class="n">fbHomeFinish</span><span class="o">.</span><span class="n">bSofLimEnableHigh</span><span class="o">:=</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">bSofLimEnableHighOriginal</span><span class="p">;</span>
                      <span class="n">fbHomeFinish</span><span class="o">.</span><span class="n">bSofLimEnableLow</span><span class="o">:=</span><span class="n">fbHomePrepare</span><span class="o">.</span><span class="n">bSofLimEnableLowOriginal</span><span class="p">;</span>
            <span class="n">END_IF</span><span class="p">;</span>
          <span class="mi">3</span><span class="p">:</span> <span class="o">//</span> <span class="n">Restore</span> <span class="n">softlimit</span> <span class="n">enable</span>
            <span class="n">bHomed</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
                <span class="n">bSequenceReady</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">IF</span> <span class="n">fbHomeFinish</span><span class="o">.</span><span class="n">bDone</span> <span class="n">THEN</span>
                      <span class="n">bRestoreNCDataNeeded</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
              <span class="n">bSequenceReady</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
                      <span class="n">nHomingState</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
                      <span class="n">bHomed</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Homed</span><span class="p">;</span>
            <span class="n">END_IF</span><span class="p">;</span>
       <span class="n">END_CASE</span><span class="p">;</span>

   <span class="mi">15</span><span class="p">:</span> <span class="o">//</span><span class="n">Set</span> <span class="n">current</span> <span class="n">position</span> <span class="p">(</span><span class="n">simplest</span> <span class="n">homing</span> <span class="n">sequence</span><span class="p">)</span>
     <span class="n">bExecuteHomeDirect</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">;</span>
     <span class="n">bHomed</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Homed</span><span class="p">;</span>
     <span class="n">IF</span> <span class="n">fbHomeDirect</span><span class="o">.</span><span class="n">bDone</span> <span class="n">THEN</span>  <span class="o">//</span><span class="n">Homing</span> <span class="n">ready</span>
       <span class="n">bExecuteHomeDirect</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
       <span class="n">bSequenceReady</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
     <span class="n">END_IF</span>

<span class="n">ELSE</span>
  <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">bCamSensor</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
  <span class="n">bHomed</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Homed</span><span class="p">;</span>
<span class="n">END_CASE</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Main</span> <span class="n">homing</span> <span class="n">block</span>
<span class="n">fbHomeToSwitch</span><span class="p">(</span>
    <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecuteHomeToSwitch</span> <span class="n">AND</span> <span class="n">bExecute</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bError</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bExecuteHomeDirect</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bExecuteMoveVelocity</span><span class="p">,</span>
    <span class="n">bReset</span><span class="o">:=</span><span class="n">bReset</span><span class="p">,</span>
    <span class="n">fHomePosition</span><span class="o">:=</span><span class="n">fHomePosition</span><span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Approach</span> <span class="n">limit</span> <span class="n">switch</span> <span class="p">(</span><span class="n">error</span> <span class="k">if</span> <span class="n">MC_Home</span> <span class="ow">is</span> <span class="n">used</span><span class="p">)</span>
<span class="n">fbMoveVelocity</span><span class="p">(</span>
    <span class="n">Execute</span><span class="o">:=</span> <span class="n">bExecuteMoveVelocity</span> <span class="n">AND</span> <span class="n">bExecute</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bError</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bExecuteHomeToSwitch</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bExecuteHomeDirect</span><span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">No</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">just</span> <span class="nb">set</span> <span class="n">position</span> <span class="n">value</span> <span class="p">(</span><span class="n">nCmdDataLocal</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span> <span class="n">Can</span> <span class="ow">not</span> <span class="n">run</span> <span class="k">if</span> <span class="n">fbHomeToSwitch</span> <span class="ow">is</span> <span class="n">executed</span>
<span class="n">fbHomeDirect</span><span class="p">(</span>
    <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecuteHomeDirect</span> <span class="n">AND</span> <span class="n">bExecute</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bError</span>  <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bExecuteHomeToSwitch</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bExecuteMoveVelocity</span><span class="p">,</span>
    <span class="n">bReset</span><span class="o">:=</span><span class="n">bReset</span><span class="p">,</span>
    <span class="n">fHomePosition</span><span class="o">:=</span><span class="n">fHomePosition</span><span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span>
<span class="p">);</span>


<span class="o">//</span><span class="c1">############# Finish homing</span>

<span class="n">IF</span> <span class="n">NOT</span> <span class="n">bexecute</span> <span class="n">AND</span> <span class="n">bRestoreNCDataNeeded</span> <span class="n">THEN</span>  <span class="o">//</span><span class="n">If</span> <span class="n">homing</span> <span class="ow">is</span> <span class="n">aborted</span> <span class="n">restore</span> <span class="ow">is</span> <span class="n">needed</span>
    <span class="n">bExecuteFinish</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">IF</span> <span class="n">fbHomeFinish</span><span class="o">.</span><span class="n">bDone</span> <span class="n">THEN</span>
      <span class="n">bExecuteFinish</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
      <span class="n">bRestoreNCDataNeeded</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">fbHomeFinish</span><span class="p">(</span>
  <span class="n">En</span><span class="o">:=</span><span class="n">En</span><span class="p">,</span>
  <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecuteFinish</span><span class="p">,</span>
  <span class="n">bReset</span><span class="o">:=</span><span class="n">bReset</span><span class="p">,</span>
  <span class="n">Axis</span><span class="o">:=</span><span class="n">Axis</span><span class="p">,</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Error</span> <span class="n">handling</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="n">bError</span> <span class="n">THEN</span>
  <span class="n">IF</span> <span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">bError</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbHomeToSwitch</span><span class="o">.</span><span class="n">nErrorId</span><span class="p">;</span>
  <span class="n">ELSIF</span> <span class="n">fbHomeDirect</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">fbHomeDirect</span><span class="o">.</span><span class="n">bError</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbHomeDirect</span><span class="o">.</span><span class="n">nErrorId</span><span class="p">;</span>
  <span class="n">ELSIF</span> <span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">Error</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">Error</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbMoveVelocity</span><span class="o">.</span><span class="n">ErrorId</span><span class="p">;</span>
  <span class="n">END_IF</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Done</span> <span class="ow">and</span> <span class="n">busy</span> <span class="n">bit</span>
<span class="n">bDone</span><span class="o">:=</span><span class="n">bSequenceReady</span> <span class="n">AND</span> <span class="n">bExecute</span><span class="p">;</span>
<span class="n">bBusy</span><span class="o">:=</span><span class="n">NOT</span> <span class="n">bSequenceReady</span><span class="p">;</span>

<span class="n">RETURN</span><span class="p">;</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-homedirect">FB_HomeDirect</a></p></li>
<li><p><a class="reference internal" href="#fb-homefinish">FB_HomeFinish</a></p></li>
<li><p><a class="reference internal" href="#fb-homeprepare">FB_HomePrepare</a></p></li>
<li><p><a class="reference internal" href="#fb-hometoswitch">FB_HomeToSwitch</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-homewritencvelocities">
<h2>FB_HomeWriteNcVelocities<a class="headerlink" href="#fb-homewritencvelocities" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_HomeWriteNcVelocities</span>
<span class="n">VAR_INPUT</span>
    <span class="n">En</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bReset</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">fVelocityToCam</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fVelocityFromCam</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">Axis</span><span class="p">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">EnO</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bDone</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">fbExecuteRiseEdge</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">fbWriteVelocityToCam</span><span class="p">:</span><span class="n">FB_WriteFloatParameter</span><span class="p">;</span>
    <span class="n">fbWriteVelocityFromCam</span><span class="p">:</span><span class="n">FB_WriteFloatParameter</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">En</span><span class="o">:=</span><span class="n">EnO</span><span class="p">;</span>
<span class="n">IF</span> <span class="n">bReset</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fbExecuteRiseEdge</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">);</span>

<span class="n">fbWriteVelocityToCam</span><span class="p">(</span>
    <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">,</span>
    <span class="n">nDeviceGroup</span><span class="o">:=</span> <span class="mi">16</span><span class="c1">#4000,</span>
    <span class="n">nIndexOffset</span><span class="o">:=</span> <span class="mi">16</span><span class="c1">#6,</span>
    <span class="n">nData</span><span class="o">:=</span><span class="n">fVelocityToCam</span><span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span> <span class="n">Axis</span><span class="p">);</span>

<span class="n">fbWriteVelocityFromCam</span><span class="p">(</span>
    <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">,</span>
    <span class="n">nDeviceGroup</span><span class="o">:=</span> <span class="mi">16</span><span class="c1">#4000,</span>
    <span class="n">nIndexOffset</span><span class="o">:=</span> <span class="mi">16</span><span class="c1">#7,</span>
    <span class="n">nData</span><span class="o">:=</span><span class="n">fVelocityFromCam</span><span class="p">,</span>
    <span class="n">Axis</span><span class="o">:=</span> <span class="n">Axis</span><span class="p">);</span>

<span class="n">bBusy</span><span class="o">:=</span><span class="n">fbWriteVelocityFromCam</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">OR</span> <span class="n">fbWriteVelocityToCam</span><span class="o">.</span><span class="n">bBusy</span><span class="p">;</span>
<span class="n">bDone</span><span class="o">:=</span><span class="n">fbWriteVelocityFromCam</span><span class="o">.</span><span class="n">bDone</span> <span class="n">AND</span> <span class="n">fbWriteVelocityToCam</span><span class="o">.</span><span class="n">bDone</span> <span class="n">AND</span> <span class="n">bExecute</span><span class="p">;</span>

<span class="n">bError</span><span class="o">:=</span><span class="n">fbWriteVelocityToCam</span><span class="o">.</span><span class="n">bError</span> <span class="n">OR</span> <span class="n">fbWriteVelocityFromCam</span><span class="o">.</span><span class="n">bError</span><span class="p">;</span>
<span class="n">IF</span> <span class="n">fbWriteVelocityToCam</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbWriteVelocityToCam</span><span class="o">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbWriteVelocityFromCam</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbWriteVelocityFromCam</span><span class="o">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-writefloatparameter">FB_WriteFloatParameter</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-homewritesoftlimenable">
<h2>FB_HomeWriteSoftLimEnable<a class="headerlink" href="#fb-homewritesoftlimenable" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_HomeWriteSoftLimEnable</span>
<span class="n">VAR_INPUT</span>
    <span class="n">En</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bReset</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecute</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bSofLimEnableLow</span><span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bSofLimEnableHigh</span><span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">Axis</span><span class="p">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">EnO</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bDone</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">fbExecuteRiseEdge</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">fbWriteSoftLimEnableLow</span><span class="p">:</span><span class="n">FB_WriteParameterInNc_v1_00</span><span class="p">;</span>
    <span class="n">fbWriteSoftLimEnableHigh</span><span class="p">:</span><span class="n">FB_WriteParameterInNc_v1_00</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">En</span><span class="o">:=</span><span class="n">EnO</span><span class="p">;</span>
<span class="n">IF</span> <span class="n">bReset</span> <span class="n">THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fbExecuteRiseEdge</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">);</span>

<span class="n">fbWriteSoftLimEnableLow</span><span class="p">(</span>
    <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">,</span>
    <span class="n">nDeviceGroup</span><span class="o">:=</span> <span class="mi">16</span><span class="c1">#5000,</span>
    <span class="n">nIndexOffset</span><span class="o">:=</span> <span class="mi">16</span><span class="c1">#B,</span>
    <span class="n">nData</span><span class="o">:=</span><span class="n">BOOL_TO_DWORD</span><span class="p">(</span><span class="n">bSofLimEnableLow</span><span class="p">),</span>
    <span class="n">Axis</span><span class="o">:=</span> <span class="n">Axis</span><span class="p">);</span>

<span class="n">fbWriteSoftLimEnableHigh</span><span class="p">(</span>
    <span class="n">bExecute</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">,</span>
    <span class="n">nDeviceGroup</span><span class="o">:=</span> <span class="mi">16</span><span class="c1">#5000,</span>
    <span class="n">nIndexOffset</span><span class="o">:=</span> <span class="mi">16</span><span class="c1">#C,</span>
    <span class="n">nData</span><span class="o">:=</span><span class="n">BOOL_TO_DWORD</span><span class="p">(</span><span class="n">bSofLimEnableHigh</span><span class="p">),</span>
    <span class="n">Axis</span><span class="o">:=</span> <span class="n">Axis</span><span class="p">);</span>

<span class="n">bBusy</span><span class="o">:=</span><span class="n">fbWriteSoftLimEnableLow</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">OR</span> <span class="n">fbWriteSoftLimEnableHigh</span><span class="o">.</span><span class="n">bBusy</span><span class="p">;</span>
<span class="n">bDone</span><span class="o">:=</span><span class="n">fbWriteSoftLimEnableLow</span><span class="o">.</span><span class="n">bDone</span> <span class="n">AND</span> <span class="n">fbWriteSoftLimEnableHigh</span><span class="o">.</span><span class="n">bDone</span> <span class="n">AND</span> <span class="n">bExecute</span><span class="p">;</span>

<span class="n">bError</span><span class="o">:=</span><span class="n">fbWriteSoftLimEnableHigh</span><span class="o">.</span><span class="n">bError</span> <span class="n">OR</span> <span class="n">fbWriteSoftLimEnableLow</span><span class="o">.</span><span class="n">bError</span><span class="p">;</span>
<span class="n">IF</span> <span class="n">fbWriteSoftLimEnableHigh</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbWriteSoftLimEnableHigh</span><span class="o">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">fbWriteSoftLimEnableLow</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
  <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbWriteSoftLimEnableLow</span><span class="o">.</span><span class="n">nErrorId</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-writeparameterinnc-v1-00">FB_WriteParameterInNc_v1_00</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-ncaxis">
<h2>FB_NcAxis<a class="headerlink" href="#fb-ncaxis" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">///</span><span class="c1">#########################################################</span>
<span class="o">///</span><span class="n">Function</span> <span class="n">block</span> <span class="n">to</span> <span class="n">communicate</span> <span class="n">between</span> <span class="n">Nc</span> <span class="ow">and</span> <span class="n">Plc</span><span class="o">.</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">Library</span><span class="p">:</span>
<span class="o">///</span> <span class="n">Tc2_MC2</span><span class="o">.</span><span class="n">lib</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">Global</span> <span class="n">Variables</span><span class="p">:</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">Data</span> <span class="n">types</span><span class="p">:</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">External</span> <span class="n">functions</span><span class="p">:</span>
<span class="o">///</span>
<span class="o">///</span><span class="c1">###########################################################</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">FB_NcAxis</span>
<span class="n">VAR</span>
    <span class="n">sVersion</span><span class="p">:</span> <span class="n">STRING</span><span class="o">:=</span><span class="s1">&#39;1.0.0&#39;</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>
    <span class="n">En</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">EnO</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">Status</span><span class="p">:</span> <span class="n">ST_AxisStatus</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">Axis</span><span class="p">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
    <span class="n">InfoData_State</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">UINT</span> <span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">EnO</span><span class="o">:=</span><span class="n">En</span><span class="p">;</span>


<span class="n">IF</span> <span class="n">En</span> <span class="n">AND</span> <span class="n">InfoData_State</span><span class="o">&lt;&gt;</span><span class="mi">16</span><span class="c1">#8 THEN</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">ELSE</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="n">En</span> <span class="n">THEN</span>
    <span class="n">Axis</span><span class="o">.</span><span class="n">ReadStatus</span><span class="p">();</span>
    <span class="n">Status</span><span class="o">:=</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</section>
<section id="fb-readfloatparameter">
<h2>FB_ReadFloatParameter<a class="headerlink" href="#fb-readfloatparameter" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_ReadFloatParameter</span>
<span class="n">VAR_INPUT</span>
    <span class="n">bExecute</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="o">///</span><span class="mi">16</span><span class="c1">#4000=Axisdata, 16#5000=Encoderdata, 16#6000=Controldata, 16#7000=Drivedata</span>
    <span class="n">nDeviceGroup</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
    <span class="n">nIndexOffset</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">nData</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bDone</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">Axis</span><span class="p">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">nState</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">fbADSREAD</span><span class="p">:</span> <span class="n">ADSREAD</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span><span class="n">Sequence</span> <span class="n">to</span> <span class="n">read</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">Nc</span><span class="o">*</span><span class="p">)</span>
<span class="n">CASE</span> <span class="n">nState</span> <span class="n">OF</span>
<span class="mi">0</span><span class="p">:</span>  <span class="p">(</span><span class="o">*</span><span class="n">Start</span> <span class="n">sequence</span><span class="o">.</span> <span class="n">Wait</span> <span class="n">until</span> <span class="n">bExecute</span> <span class="ow">is</span> <span class="n">TRUE</span><span class="o">*</span><span class="p">)</span>
    <span class="n">IF</span> <span class="n">bExecute</span> <span class="n">THEN</span>
            <span class="n">bBusy</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
            <span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
            <span class="n">nState</span><span class="o">:=</span><span class="mi">10</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">10</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">Read</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">Nc</span><span class="o">*</span><span class="p">)</span>
    <span class="n">fbADSREAD</span><span class="p">(</span>
            <span class="n">PORT</span><span class="o">:=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">IDXGRP</span><span class="o">:=</span><span class="n">nDeviceGroup</span><span class="o">+</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">AxisId</span><span class="p">,</span>
            <span class="n">IDXOFFS</span><span class="o">:=</span><span class="n">nIndexOffset</span><span class="p">,</span>
            <span class="n">LEN</span><span class="o">:=</span><span class="n">SIZEOF</span><span class="p">(</span><span class="n">nData</span><span class="p">),</span>
            <span class="n">DESTADDR</span><span class="o">:=</span><span class="n">ADR</span><span class="p">(</span><span class="n">nData</span><span class="p">),</span>
            <span class="n">READ</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Wait</span> <span class="n">until</span> <span class="n">it</span><span class="s1">&#39;s done or if an error occurs*)</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">fbADSREAD</span><span class="o">.</span><span class="n">ERR</span> <span class="n">THEN</span>
            <span class="n">IF</span> <span class="n">NOT</span> <span class="n">fbADSREAD</span><span class="o">.</span><span class="n">BUSY</span> <span class="n">THEN</span>
                    <span class="n">fbADSREAD</span><span class="p">(</span><span class="n">READ</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
                    <span class="n">nState</span><span class="o">:=</span><span class="mi">20</span><span class="p">;</span>
            <span class="n">END_IF</span>
    <span class="n">ELSE</span>
            <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbADSREAD</span><span class="o">.</span><span class="n">ERRID</span><span class="p">;</span>
            <span class="n">nState</span><span class="o">:=</span><span class="mi">999</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">20</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">Sequense</span> <span class="ow">is</span> <span class="n">done</span><span class="o">.</span> <span class="n">Waits</span> <span class="n">until</span> <span class="n">bExecute</span> <span class="ow">is</span> <span class="n">FALSE</span><span class="o">*</span><span class="p">)</span>
    <span class="n">bBusy</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDone</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">bExecute</span> <span class="n">THEN</span>
            <span class="n">bDone</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">nState</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">999</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">Error</span> <span class="ow">in</span> <span class="n">sequence</span><span class="o">*</span><span class="p">)</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDone</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">fbADSREAD</span><span class="p">(</span><span class="n">READ</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">bExecute</span> <span class="n">THEN</span>
            <span class="n">nState</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="n">END_CASE</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</section>
<section id="fb-readparameterinnc-v1-00">
<h2>FB_ReadParameterInNc_v1_00<a class="headerlink" href="#fb-readparameterinnc-v1-00" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">///</span><span class="c1">#########################################################</span>
<span class="o">///</span><span class="n">Function</span> <span class="n">block</span> <span class="n">to</span> <span class="n">read</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">Nc</span><span class="o">.</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">Library</span><span class="p">:</span>
<span class="o">///</span> <span class="n">Tc2_MC2</span><span class="o">.</span><span class="n">lib</span>
<span class="o">///</span> <span class="n">Tc2_System</span><span class="o">.</span><span class="n">lib</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">Global</span> <span class="n">Variables</span><span class="p">:</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">Data</span> <span class="n">types</span><span class="p">:</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">External</span> <span class="n">functions</span><span class="p">:</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">History</span><span class="p">:</span>
<span class="o">///</span> <span class="mi">2014</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">05</span>      <span class="n">v1</span><span class="mf">.00</span>   <span class="n">NB</span>      <span class="n">Release</span> <span class="n">code</span><span class="o">.</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">Known</span> <span class="n">bugs</span><span class="p">:</span>
<span class="o">///</span>
<span class="o">///</span>
<span class="o">///</span>
<span class="o">///</span><span class="c1">###########################################################</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">FB_ReadParameterInNc_v1_00</span>
<span class="n">VAR_INPUT</span>
    <span class="n">bExecute</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="o">///</span><span class="mi">16</span><span class="c1">#4000=Axisdata, 16#5000=Encoderdata, 16#6000=Controldata, 16#7000=Drivedata</span>
    <span class="n">nDeviceGroup</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
    <span class="n">nIndexOffset</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">nData</span><span class="p">:</span> <span class="n">DWORD</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bDone</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">Axis</span><span class="p">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">nState</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">fbADSREAD</span><span class="p">:</span> <span class="n">ADSREAD</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span><span class="n">Sequence</span> <span class="n">to</span> <span class="n">read</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">Nc</span><span class="o">*</span><span class="p">)</span>
<span class="n">CASE</span> <span class="n">nState</span> <span class="n">OF</span>
<span class="mi">0</span><span class="p">:</span>  <span class="p">(</span><span class="o">*</span><span class="n">Start</span> <span class="n">sequence</span><span class="o">.</span> <span class="n">Wait</span> <span class="n">until</span> <span class="n">bExecute</span> <span class="ow">is</span> <span class="n">TRUE</span><span class="o">*</span><span class="p">)</span>
    <span class="n">IF</span> <span class="n">bExecute</span> <span class="n">THEN</span>
            <span class="n">bBusy</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
            <span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
            <span class="n">nState</span><span class="o">:=</span><span class="mi">10</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">10</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">Read</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">Nc</span><span class="o">*</span><span class="p">)</span>
    <span class="n">fbADSREAD</span><span class="p">(</span>
            <span class="n">PORT</span><span class="o">:=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">IDXGRP</span><span class="o">:=</span><span class="n">nDeviceGroup</span><span class="o">+</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">AxisId</span><span class="p">,</span>
            <span class="n">IDXOFFS</span><span class="o">:=</span><span class="n">nIndexOffset</span><span class="p">,</span>
            <span class="n">LEN</span><span class="o">:=</span><span class="n">SIZEOF</span><span class="p">(</span><span class="n">nData</span><span class="p">),</span>
            <span class="n">DESTADDR</span><span class="o">:=</span><span class="n">ADR</span><span class="p">(</span><span class="n">nData</span><span class="p">),</span>
            <span class="n">READ</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Wait</span> <span class="n">until</span> <span class="n">it</span><span class="s1">&#39;s done or if an error occurs*)</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">fbADSREAD</span><span class="o">.</span><span class="n">ERR</span> <span class="n">THEN</span>
            <span class="n">IF</span> <span class="n">NOT</span> <span class="n">fbADSREAD</span><span class="o">.</span><span class="n">BUSY</span> <span class="n">THEN</span>
                    <span class="n">fbADSREAD</span><span class="p">(</span><span class="n">READ</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
                    <span class="n">nState</span><span class="o">:=</span><span class="mi">20</span><span class="p">;</span>
            <span class="n">END_IF</span>
    <span class="n">ELSE</span>
            <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbADSREAD</span><span class="o">.</span><span class="n">ERRID</span><span class="p">;</span>
            <span class="n">nState</span><span class="o">:=</span><span class="mi">999</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">20</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">Sequense</span> <span class="ow">is</span> <span class="n">done</span><span class="o">.</span> <span class="n">Waits</span> <span class="n">until</span> <span class="n">bExecute</span> <span class="ow">is</span> <span class="n">FALSE</span><span class="o">*</span><span class="p">)</span>
    <span class="n">bBusy</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDone</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">bExecute</span> <span class="n">THEN</span>
            <span class="n">bDone</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">nState</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">999</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">Error</span> <span class="ow">in</span> <span class="n">sequence</span><span class="o">*</span><span class="p">)</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDone</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">fbADSREAD</span><span class="p">(</span><span class="n">READ</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">bExecute</span> <span class="n">THEN</span>
            <span class="n">nState</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="n">END_CASE</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</section>
<section id="fb-writefloatparameter">
<h2>FB_WriteFloatParameter<a class="headerlink" href="#fb-writefloatparameter" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">///</span><span class="c1">#########################################################</span>
<span class="o">///</span><span class="n">Function</span> <span class="n">block</span> <span class="n">to</span> <span class="n">write</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">Nc</span><span class="o">.</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">Library</span><span class="p">:</span>
<span class="o">///</span> <span class="n">Tc2_MC2</span><span class="o">.</span><span class="n">lib</span>
<span class="o">///</span> <span class="n">Tc2_System</span><span class="o">.</span><span class="n">lib</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">Global</span> <span class="n">Variables</span><span class="p">:</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">Data</span> <span class="n">types</span><span class="p">:</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">External</span> <span class="n">functions</span><span class="p">:</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">History</span><span class="p">:</span>
<span class="o">///</span> <span class="mi">2014</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">05</span>      <span class="n">v1</span><span class="mf">.00</span>   <span class="n">NB</span>      <span class="n">Release</span> <span class="n">code</span><span class="o">.</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">Known</span> <span class="n">bugs</span><span class="p">:</span>
<span class="o">///</span>
<span class="o">///</span>
<span class="o">///</span>
<span class="o">///</span><span class="c1">###########################################################</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">FB_WriteFloatParameter</span>
<span class="n">VAR_INPUT</span>
    <span class="n">bExecute</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="o">///</span><span class="mi">16</span><span class="c1">#4000=Axisdata, 16#5000=Encoderdata, 16#6000=Controldata, 16#7000=Drivedata</span>
    <span class="n">nDeviceGroup</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
    <span class="n">nIndexOffset</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
    <span class="n">nData</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bDone</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">Axis</span><span class="p">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">nState</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">fbADSWRITE</span><span class="p">:</span> <span class="n">ADSWRITE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span><span class="n">Sequence</span> <span class="n">to</span> <span class="n">write</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">Nc</span><span class="o">*</span><span class="p">)</span>
<span class="n">CASE</span> <span class="n">nState</span> <span class="n">OF</span>
<span class="mi">0</span><span class="p">:</span>  <span class="p">(</span><span class="o">*</span><span class="n">Start</span> <span class="n">sequence</span><span class="o">.</span> <span class="n">Wait</span> <span class="n">until</span> <span class="n">bExecute</span> <span class="ow">is</span> <span class="n">TRUE</span><span class="o">*</span><span class="p">)</span>
    <span class="n">IF</span> <span class="n">bExecute</span> <span class="n">THEN</span>
            <span class="n">bBusy</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
            <span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
            <span class="n">nState</span><span class="o">:=</span><span class="mi">10</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">10</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">Write</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">Nc</span><span class="o">*</span><span class="p">)</span>
    <span class="n">fbADSWRITE</span><span class="p">(</span>
            <span class="n">PORT</span><span class="o">:=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">IDXGRP</span><span class="o">:=</span><span class="n">nDeviceGroup</span><span class="o">+</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">AxisId</span><span class="p">,</span>
            <span class="n">IDXOFFS</span><span class="o">:=</span><span class="n">nIndexOffset</span><span class="p">,</span>
            <span class="n">LEN</span><span class="o">:=</span><span class="n">SIZEOF</span><span class="p">(</span><span class="n">nData</span><span class="p">),</span>
            <span class="n">SRCADDR</span><span class="o">:=</span><span class="n">ADR</span><span class="p">(</span><span class="n">nData</span><span class="p">),</span>
            <span class="n">WRITE</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Wait</span> <span class="n">until</span> <span class="n">it</span><span class="s1">&#39;s done or if an error occurs*)</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">fbADSWRITE</span><span class="o">.</span><span class="n">ERR</span> <span class="n">THEN</span>
            <span class="n">IF</span> <span class="n">NOT</span> <span class="n">fbADSWRITE</span><span class="o">.</span><span class="n">BUSY</span> <span class="n">THEN</span>
                    <span class="n">fbADSWRITE</span><span class="p">(</span><span class="n">WRITE</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
                    <span class="n">nState</span><span class="o">:=</span><span class="mi">20</span><span class="p">;</span>
            <span class="n">END_IF</span>
    <span class="n">ELSE</span>
            <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbADSWRITE</span><span class="o">.</span><span class="n">ERRID</span><span class="p">;</span>
            <span class="n">nState</span><span class="o">:=</span><span class="mi">999</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">20</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">Sequense</span> <span class="ow">is</span> <span class="n">done</span><span class="o">.</span> <span class="n">Waits</span> <span class="n">until</span> <span class="n">bExecute</span> <span class="ow">is</span> <span class="n">FALSE</span><span class="o">*</span><span class="p">)</span>
    <span class="n">bBusy</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDone</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">bExecute</span> <span class="n">THEN</span>
            <span class="n">bDone</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">nState</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">999</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">Error</span> <span class="ow">in</span> <span class="n">sequence</span><span class="o">*</span><span class="p">)</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDone</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">fbADSWRITE</span><span class="p">(</span><span class="n">WRITE</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">bExecute</span> <span class="n">THEN</span>
            <span class="n">nState</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="n">END_CASE</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</section>
<section id="fb-writeparameterinnc-v1-00">
<h2>FB_WriteParameterInNc_v1_00<a class="headerlink" href="#fb-writeparameterinnc-v1-00" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">///</span><span class="c1">#########################################################</span>
<span class="o">///</span><span class="n">Function</span> <span class="n">block</span> <span class="n">to</span> <span class="n">write</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">Nc</span><span class="o">.</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">Library</span><span class="p">:</span>
<span class="o">///</span> <span class="n">Tc2_MC2</span><span class="o">.</span><span class="n">lib</span>
<span class="o">///</span> <span class="n">Tc2_System</span><span class="o">.</span><span class="n">lib</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">Global</span> <span class="n">Variables</span><span class="p">:</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">Data</span> <span class="n">types</span><span class="p">:</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">External</span> <span class="n">functions</span><span class="p">:</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">History</span><span class="p">:</span>
<span class="o">///</span> <span class="mi">2014</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">05</span>      <span class="n">v1</span><span class="mf">.00</span>   <span class="n">NB</span>      <span class="n">Release</span> <span class="n">code</span><span class="o">.</span>
<span class="o">///</span>
<span class="o">///</span> <span class="n">Known</span> <span class="n">bugs</span><span class="p">:</span>
<span class="o">///</span>
<span class="o">///</span>
<span class="o">///</span>
<span class="o">///</span><span class="c1">###########################################################</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">FB_WriteParameterInNc_v1_00</span>
<span class="n">VAR_INPUT</span>
    <span class="n">bExecute</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="o">///</span><span class="mi">16</span><span class="c1">#4000=Axisdata, 16#5000=Encoderdata, 16#6000=Controldata, 16#7000=Drivedata</span>
    <span class="n">nDeviceGroup</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
    <span class="n">nIndexOffset</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
    <span class="n">nData</span><span class="p">:</span> <span class="n">DWORD</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bDone</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nErrorId</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">Axis</span><span class="p">:</span> <span class="n">AXIS_REF</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">nState</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">fbADSWRITE</span><span class="p">:</span> <span class="n">ADSWRITE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span><span class="n">Sequence</span> <span class="n">to</span> <span class="n">write</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">Nc</span><span class="o">*</span><span class="p">)</span>
<span class="n">CASE</span> <span class="n">nState</span> <span class="n">OF</span>
<span class="mi">0</span><span class="p">:</span>  <span class="p">(</span><span class="o">*</span><span class="n">Start</span> <span class="n">sequence</span><span class="o">.</span> <span class="n">Wait</span> <span class="n">until</span> <span class="n">bExecute</span> <span class="ow">is</span> <span class="n">TRUE</span><span class="o">*</span><span class="p">)</span>
    <span class="n">IF</span> <span class="n">bExecute</span> <span class="n">THEN</span>
            <span class="n">bBusy</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
            <span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">nErrorId</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
            <span class="n">nState</span><span class="o">:=</span><span class="mi">10</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">10</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">Write</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">Nc</span><span class="o">*</span><span class="p">)</span>
    <span class="n">fbADSWRITE</span><span class="p">(</span>
            <span class="n">PORT</span><span class="o">:=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">IDXGRP</span><span class="o">:=</span><span class="n">nDeviceGroup</span><span class="o">+</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">AxisId</span><span class="p">,</span>
            <span class="n">IDXOFFS</span><span class="o">:=</span><span class="n">nIndexOffset</span><span class="p">,</span>
            <span class="n">LEN</span><span class="o">:=</span><span class="n">SIZEOF</span><span class="p">(</span><span class="n">nData</span><span class="p">),</span>
            <span class="n">SRCADDR</span><span class="o">:=</span><span class="n">ADR</span><span class="p">(</span><span class="n">nData</span><span class="p">),</span>
            <span class="n">WRITE</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Wait</span> <span class="n">until</span> <span class="n">it</span><span class="s1">&#39;s done or if an error occurs*)</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">fbADSWRITE</span><span class="o">.</span><span class="n">ERR</span> <span class="n">THEN</span>
            <span class="n">IF</span> <span class="n">NOT</span> <span class="n">fbADSWRITE</span><span class="o">.</span><span class="n">BUSY</span> <span class="n">THEN</span>
                    <span class="n">fbADSWRITE</span><span class="p">(</span><span class="n">WRITE</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
                    <span class="n">nState</span><span class="o">:=</span><span class="mi">20</span><span class="p">;</span>
            <span class="n">END_IF</span>
    <span class="n">ELSE</span>
            <span class="n">nErrorId</span><span class="o">:=</span><span class="n">fbADSWRITE</span><span class="o">.</span><span class="n">ERRID</span><span class="p">;</span>
            <span class="n">nState</span><span class="o">:=</span><span class="mi">999</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">20</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">Sequense</span> <span class="ow">is</span> <span class="n">done</span><span class="o">.</span> <span class="n">Waits</span> <span class="n">until</span> <span class="n">bExecute</span> <span class="ow">is</span> <span class="n">FALSE</span><span class="o">*</span><span class="p">)</span>
    <span class="n">bBusy</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDone</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">bExecute</span> <span class="n">THEN</span>
            <span class="n">bDone</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">nState</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">999</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">Error</span> <span class="ow">in</span> <span class="n">sequence</span><span class="o">*</span><span class="p">)</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDone</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">fbADSWRITE</span><span class="p">(</span><span class="n">WRITE</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">bExecute</span> <span class="n">THEN</span>
            <span class="n">nState</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="n">END_CASE</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</section>
<section id="main">
<h2>Main<a class="headerlink" href="#main" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">Main</span>
<span class="n">VAR</span>
    <span class="n">nSanityCount</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>

    <span class="n">M1</span><span class="p">:</span> <span class="n">FB_DriveVirtual</span><span class="p">;</span>
    <span class="n">M1Link</span><span class="p">:</span> <span class="n">FB_NcAxis</span><span class="p">;</span>
    <span class="n">bLimitFwdM1</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bLimitBwdM1</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">M2</span><span class="p">:</span> <span class="n">FB_DriveVirtual</span><span class="p">;</span>
    <span class="n">M2Link</span><span class="p">:</span> <span class="n">FB_NcAxis</span><span class="p">;</span>
    <span class="n">bLimitFwdM2</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bLimitBwdM2</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">M3</span><span class="p">:</span> <span class="n">FB_DriveVirtual</span><span class="p">;</span>
    <span class="n">M3Link</span><span class="p">:</span> <span class="n">FB_NcAxis</span><span class="p">;</span>
    <span class="n">bLimitFwdM3</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bLimitBwdM3</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">M4</span><span class="p">:</span> <span class="n">FB_DriveVirtual</span><span class="p">;</span>
    <span class="n">M4Link</span><span class="p">:</span> <span class="n">FB_NcAxis</span><span class="p">;</span>
    <span class="n">bLimitFwdM4</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bLimitBwdM4</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">M5</span><span class="p">:</span> <span class="n">FB_DriveVirtual</span><span class="p">;</span>
    <span class="n">M5Link</span><span class="p">:</span> <span class="n">FB_NcAxis</span><span class="p">;</span>
    <span class="n">bLimitFwdM5</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bLimitBwdM5</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">M6</span><span class="p">:</span> <span class="n">FB_DriveVirtual</span><span class="p">;</span>
    <span class="n">M6Link</span><span class="p">:</span> <span class="n">FB_NcAxis</span><span class="p">;</span>
    <span class="n">bLimitFwdM6</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bLimitBwdM6</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">M7</span><span class="p">:</span> <span class="n">FB_DriveVirtual</span><span class="p">;</span>
    <span class="n">M7Link</span><span class="p">:</span> <span class="n">FB_NcAxis</span><span class="p">;</span>
    <span class="n">bLimitFwdM7</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bLimitBwdM7</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">M8</span><span class="p">:</span> <span class="n">FB_DriveVirtual</span><span class="p">;</span>
    <span class="n">M8Link</span><span class="p">:</span> <span class="n">FB_NcAxis</span><span class="p">;</span>
    <span class="n">bLimitFwdM8</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bLimitBwdM8</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">M9</span><span class="p">:</span> <span class="n">FB_DriveVirtual</span><span class="p">;</span>
    <span class="n">M9Link</span><span class="p">:</span> <span class="n">FB_NcAxis</span><span class="p">;</span>
    <span class="n">bLimitFwdM9</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bLimitBwdM9</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">M10</span><span class="p">:</span> <span class="n">FB_DriveVirtual</span><span class="p">;</span>
    <span class="n">M10Link</span><span class="p">:</span> <span class="n">FB_NcAxis</span><span class="p">;</span>
    <span class="n">bLimitFwdM10</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bLimitBwdM10</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">M11</span><span class="p">:</span> <span class="n">FB_DriveVirtual</span><span class="p">;</span>
    <span class="n">M11Link</span><span class="p">:</span> <span class="n">FB_NcAxis</span><span class="p">;</span>
    <span class="n">bLimitFwdM11</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bLimitBwdM11</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">M12</span><span class="p">:</span> <span class="n">FB_DriveVirtual</span><span class="p">;</span>
    <span class="n">M12Link</span><span class="p">:</span> <span class="n">FB_NcAxis</span><span class="p">;</span>
    <span class="n">bLimitFwdM12</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bLimitBwdM12</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">M13</span><span class="p">:</span> <span class="n">FB_DriveVirtual</span><span class="p">;</span>
    <span class="n">M13Link</span><span class="p">:</span> <span class="n">FB_NcAxis</span><span class="p">;</span>
    <span class="n">bLimitFwdM13</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bLimitBwdM13</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">nSanityCount</span> <span class="o">:=</span> <span class="n">nSanityCount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

<span class="n">M1Link</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="n">M1</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bLimitFwd</span> <span class="o">:=</span> <span class="n">bLimitFwdM1</span><span class="p">,</span>
   <span class="n">bLimitBwd</span> <span class="o">:=</span> <span class="n">bLimitBwdM1</span><span class="p">,</span>
   <span class="n">Axis</span> <span class="o">:=</span> <span class="n">M1Link</span><span class="o">.</span><span class="n">axis</span><span class="p">);</span>

<span class="n">M2Link</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="n">M2</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bLimitFwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitFwdM2</span><span class="p">,</span>
   <span class="n">bLimitBwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitBwdM2</span><span class="p">,</span>
   <span class="n">Axis</span> <span class="o">:=</span> <span class="n">M2Link</span><span class="o">.</span><span class="n">axis</span><span class="p">);</span>

<span class="n">M3Link</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="n">M3</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bLimitFwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitFwdM3</span><span class="p">,</span>
   <span class="n">bLimitBwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitBwdM3</span><span class="p">,</span>
   <span class="n">Axis</span> <span class="o">:=</span> <span class="n">M3Link</span><span class="o">.</span><span class="n">axis</span><span class="p">);</span>

<span class="n">M4Link</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="n">M4</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bLimitFwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitFwdM4</span><span class="p">,</span>
   <span class="n">bLimitBwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitBwdM4</span><span class="p">,</span>
   <span class="n">Axis</span> <span class="o">:=</span> <span class="n">M4Link</span><span class="o">.</span><span class="n">axis</span><span class="p">);</span>

<span class="n">M5Link</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="n">M5</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bLimitFwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitFwdM5</span><span class="p">,</span>
   <span class="n">bLimitBwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitBwdM5</span><span class="p">,</span>
   <span class="n">Axis</span> <span class="o">:=</span> <span class="n">M5Link</span><span class="o">.</span><span class="n">axis</span><span class="p">);</span>

<span class="n">M6Link</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="n">M6</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bLimitFwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitFwdM6</span><span class="p">,</span>
   <span class="n">bLimitBwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitBwdM6</span><span class="p">,</span>
   <span class="n">Axis</span> <span class="o">:=</span> <span class="n">M6Link</span><span class="o">.</span><span class="n">axis</span><span class="p">);</span>

<span class="n">M7Link</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="n">M7</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bLimitFwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitFwdM7</span><span class="p">,</span>
   <span class="n">bLimitBwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitBwdM7</span><span class="p">,</span>
   <span class="n">Axis</span> <span class="o">:=</span> <span class="n">M7Link</span><span class="o">.</span><span class="n">axis</span><span class="p">);</span>

<span class="n">M8Link</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="n">M8</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bLimitFwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitFwdM8</span><span class="p">,</span>
   <span class="n">bLimitBwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitBwdM8</span><span class="p">,</span>
   <span class="n">Axis</span> <span class="o">:=</span> <span class="n">M8Link</span><span class="o">.</span><span class="n">axis</span><span class="p">);</span>

<span class="n">M9Link</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="n">M9</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bLimitFwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitFwdM9</span><span class="p">,</span>
   <span class="n">bLimitBwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitBwdM9</span><span class="p">,</span>
   <span class="n">Axis</span> <span class="o">:=</span> <span class="n">M9Link</span><span class="o">.</span><span class="n">axis</span><span class="p">);</span>

<span class="n">M10Link</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="n">M10</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bLimitFwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitFwdM10</span><span class="p">,</span>
   <span class="n">bLimitBwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitBwdM10</span><span class="p">,</span>
   <span class="n">Axis</span> <span class="o">:=</span> <span class="n">M10Link</span><span class="o">.</span><span class="n">axis</span><span class="p">);</span>

<span class="n">M11Link</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="n">M11</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bLimitFwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitFwdM11</span><span class="p">,</span>
   <span class="n">bLimitBwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitBwdM11</span><span class="p">,</span>
   <span class="n">Axis</span> <span class="o">:=</span> <span class="n">M11Link</span><span class="o">.</span><span class="n">axis</span><span class="p">);</span>

<span class="n">M12Link</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="n">M12</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bLimitFwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitFwdM12</span><span class="p">,</span>
   <span class="n">bLimitBwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitBwdM12</span><span class="p">,</span>
   <span class="n">Axis</span> <span class="o">:=</span> <span class="n">M12Link</span><span class="o">.</span><span class="n">axis</span><span class="p">);</span>

<span class="n">M13Link</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="n">M13</span><span class="p">(</span><span class="n">En</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
   <span class="n">bLimitFwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitFwdM13</span><span class="p">,</span>
   <span class="n">bLimitBwd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">//</span> <span class="n">bLimitBwdM13</span><span class="p">,</span>
   <span class="n">Axis</span> <span class="o">:=</span> <span class="n">M13Link</span><span class="o">.</span><span class="n">axis</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-drivevirtual">FB_DriveVirtual</a></p></li>
<li><p><a class="reference internal" href="#fb-ncaxis">FB_NcAxis</a></p></li>
</ul>
</dd>
</dl>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="VonHamos01_VonHamos01_epics.html" class="btn btn-neutral float-left" title="Data Types" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, SLAC National Accelerator Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>